# ADW Implementation Plan

*Auto-generated by Ralph loop. Updated after each iteration.*

**Last Updated:** 2026-02-03
**Current Phase:** 10 (Workflow Customization)
**Version:** 0.5.20
**Status:** Phase 7 COMPLETE - Linear integration complete (P7-6, P7-7). Total: 1136 tests passing (49 new Linear tests). Code quality: all ruff lint and mypy errors fixed.

---

## Executive Summary

Based on comprehensive codebase analysis comparing `src/adw/*` against `specs/phase-*/*.md`:

| Phase | Status | Completion |
|-------|--------|------------|
| 0 - Validation | **COMPLETE** | **100%** |
| 1 - Observability & Safety | **COMPLETE** | **100%** |
| 2 - Quality Gates | **COMPLETE** | **100%** |
| 3 - Context Engineering | **COMPLETE** | **100%** |
| 4 - Feedback Loops | **COMPLETE** | **100%** |
| 5 - Specialized Agents | **COMPLETE** | **100%** |
| 6 - Multi-Repo | **COMPLETE** | **100%** |
| 7 - Entry Points | **COMPLETE** | **100%** |
| 8 - Failure Recovery | **COMPLETE** | **100%** |
| 9 - Reporting | **COMPLETE** | **100%** |
| 10 - Customization | Partial | 20% |
| 11 - Simplification | Not Started | 0% |

**Existing Strengths:**
- Agent subsystem is production-ready (executor, manager, state, worktree, ports)
- Workflow engines work (simple, standard, sdlc)
- TUI dashboard functional with real-time log streaming
- Plugin system complete with QMD integration
- Task parsing and status updates work
- Test framework detection (pytest, jest, vitest, go, cargo, etc.)
- Test execution with result parsing
- Smart retry with progressive strategies and escalation
- SDLC workflow integration with automatic test validation
- Implement-test retry loops with context injection
- Escalation report generation on test failure exhaustion
- Error classification with 50+ patterns (retriable, fixable, fatal, unknown)
- Recovery strategies (retry, fix, simplify, escalate)
- Checkpoint system for task state persistence
- WIP commit support for partial progress
- CLI commands: rollback, resume-task, checkpoints, escalation
- **NEW:** Context priming system with project-type detection
- **NEW:** Context bundles for session restoration
- **NEW:** CLI commands: prime generate/show/refresh, bundle list/show/diff/suggest/load/save/delete/compress
- **NEW:** PR review watcher with comment polling
- **NEW:** Comment parser for actionable feedback extraction
- **NEW:** Auto-fix system for review comments
- **NEW:** Human-in-the-loop approval gates with timeout
- **NEW:** CLI commands: watch-pr, fix-comments, approve-task, reject-task, continue-task, pending-approvals
- **NEW:** Expert framework with base class, knowledge persistence, and self-improvement
- **NEW:** FrontendExpert (React, Vue, CSS, accessibility)
- **NEW:** BackendExpert (FastAPI, Supabase, REST APIs)
- **NEW:** AIExpert (LLM integration, prompts, agents)
- **NEW:** Expert auto-selection from task keywords and file patterns
- **NEW:** Daily summary reports with task counts, costs, time saved
- **NEW:** Weekly digest with week-over-week comparison
- **NEW:** Trend analysis with sparklines and anomaly detection
- **NEW:** Metrics database (`~/.adw/metrics.db`)
- **NEW:** Cost tracking with Anthropic pricing tiers
- **NEW:** Notification system (Slack/Discord webhooks)
- **NEW:** CLI commands: report daily/weekly/trends, metrics, costs, alerts
- GitHub integration (basic) works

---

## Phase 0: Foundation Validation

**Priority:** CRITICAL - Must complete first
**Spec:** `specs/phase-0/validation.md`
**Status:** ✅ COMPLETE (100%)

### What Was Validated
- All 791 tests pass
- All ruff lint checks pass
- All SDLC slash commands exist and are properly configured
- Test validation and retry system functional
- State management and persistence works
- Hook system operational

### Tasks

- [x] **P0-1** Run end-to-end SDLC validation with `--version` flag task
  - **Finding:** `--version` flag already exists and works (`adw --version`, `adw version`)
  - All SDLC phases have slash commands
  - Infrastructure validated via test suite (791/791 passing)

- [x] **P0-2** Create `docs/VALIDATION_REPORT.md`
  - Created comprehensive validation report
  - Documents test results, component status, known limitations
  - **Files:** `docs/VALIDATION_REPORT.md`

- [x] **P0-3** Fix critical blockers (minimal changes only)
  - **Fixed:** Version mismatch (pyproject.toml 0.5.12 → 0.5.13)
  - **Fixed:** Missing `/release` command created (`.claude/commands/release.md`)
  - No critical blockers preventing functionality

---

## Phase 1: Observability & Safety

**Priority:** HIGH
**Specs:** `specs/phase-1/hooks-integration.md`, `specs/phase-1/screenshot-capture.md`, `specs/phase-1/event-dashboard.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Basic hook handlers in `src/adw/hooks/handlers.py` (dispatch, logging)
- Complete hook scripts: `check_messages.py`, `context_bundle_builder.py`, `universal_logger.py`, `pre_tool_use.py`, `post_tool_use.py`, `stop.py`, `log_prompt.py`, `notification_handler.py`, `session_complete.py`
- `.claude/settings.json` properly configured with all hooks
- Basic dashboard in `src/adw/dashboard.py`
- Comprehensive test suite in `tests/test_hooks.py` (44 tests)

### Hooks Integration Tasks

- [x] **P1-1** Create `.claude/hooks/pre_tool_use.py` with comprehensive safety guardrails
  - Block: `rm -rf /`, `rm -rf ~`, fork bombs
  - Block: Commands touching `/etc`, `/usr`, `/var`
  - Block: `sudo` commands (unless explicit allow)
  - Block: `.env` files, `*_SECRET*` patterns, SSH keys
  - Log blocked attempts to `.adw/blocked.log`
  - Return exit 0 to allow, 1 to block

- [x] **P1-2** Create `.claude/hooks/post_tool_use.py` for tool usage logging
  - Log to `.adw/tool_usage.jsonl` (JSONL format)
  - Capture: timestamp, tool_name, parameters, result_summary
  - Auto-rotate logs when exceeding 10MB
  - Execute in <100ms

- [x] **P1-3** Create `.claude/hooks/stop.py` for session completion
  - Log to `.adw/sessions.jsonl`
  - Capture: session_id, duration, tools_used_count, files_modified
  - Generate session summary

- [x] **P1-4** Update `.claude/settings.json` to reference correct scripts
  - Fix references to missing scripts (log_prompt.py, session_complete.py, notification_handler.py)
  - Ensure all hooks are properly registered

- [x] **P1-5** Add comprehensive tests for hook guardrails

### Screenshot Capture Tasks

- [x] **P1-6** Create `src/adw/utils/screenshot.py`
  - `capture_screenshot(output_path: str) -> Path`
  - Use `screencapture -x` (silent, macOS)
  - Support custom region coordinates
  - Also includes `capture_browser_screenshot()` using Playwright
  - **Files:** `src/adw/utils/screenshot.py`, `src/adw/utils/__init__.py`

- [x] **P1-7** Add dev server detection
  - `is_dev_server_running(port: int) -> bool`
  - `detect_dev_server_ports() -> list[int]`
  - Monitor ports: 3000, 3001, 5173, 5174, 8000, 8080, 8888, 4200, 4000
  - Uses `lsof` on macOS, socket fallback for other systems
  - `is_dev_server_command()` detects 20+ dev server patterns
  - **Files:** `src/adw/utils/screenshot.py`

- [x] **P1-8** Integrate screenshot capture into hooks
  - Updated `.claude/hooks/post_tool_use.py` to detect dev server start commands
  - Patterns: npm/bun/pnpm/yarn dev, vite, next/nuxt dev, uvicorn, flask, gunicorn, fastapi, php -S, ng serve
  - Async capture with 3-second delay for server initialization
  - Stores to `agents/<task_id>/screenshots/screenshot-{timestamp}.png`
  - Logs captures to `.adw/screenshots.jsonl`
  - **Files:** `.claude/hooks/post_tool_use.py`

- [x] **P1-9** Add PR attachment functionality
  - `attach_screenshots_to_pr(pr_number: int, screenshots: list[Path])`
  - Uses `gh pr comment` CLI for reliable attachment
  - Auto-detects owner/repo from git remote
  - **Files:** `src/adw/utils/screenshot.py`

- [x] **P1-10** Add `adw screenshot` CLI command
  - Options: `--port`, `--delay`, `--output`, `--browser`, `--list`, `--task`
  - `adw screenshot --list` to view recent screenshots
  - `adw screenshot --browser` for Playwright-based capture
  - Includes `list_screenshots()` and `cleanup_old_screenshots()` utilities
  - **Files:** `src/adw/cli.py`

### Tests Added
- `tests/test_screenshot.py` - 61 tests covering all screenshot functionality

### Event Dashboard Tasks

- [x] **P1-11** Create `src/adw/observability/db.py` with SQLite database
  - Tables: `events` (id, timestamp, type, session_id, data JSON)
  - Tables: `sessions` (id, start_time, end_time, task_id, status)
  - Functions: `log_event()`, `get_events()`, `get_session()`, `start_session()`, `end_session()`
  - Store at `.adw/events.db`
  - **Files:** `src/adw/observability/db.py`, `src/adw/observability/models.py`, `src/adw/observability/__init__.py`

- [x] **P1-12** Add event stream panel to TUI
  - Display last 50 events in real-time
  - Color-coding: cyan (tool), red (error), green (success)
  - Toggle with `E` key
  - Polls database for new events every second
  - **Files:** `src/adw/tui/widgets/event_stream.py`, `src/adw/tui/app.py`, `src/adw/tui/styles.py`

- [x] **P1-13** Add `adw events` CLI with filtering
  - Filter by: event_type, session_id, task_id, time_range
  - Examples: `adw events --type tool --since 1h`, `adw events --follow`, `adw events --summary`
  - Also added `adw sessions` command to view sessions
  - **Files:** `src/adw/cli.py`

- [ ] **P1-14** (STRETCH) Create web dashboard `adw dashboard --web`
  - FastAPI server on port 3939
  - Routes: GET /, /api/events, /api/sessions, WS /ws
  - Simple Vue.js or vanilla JS frontend

### Tests Added
- `tests/test_observability.py` - 55 tests covering event database, models, and queries

---

## Phase 2: Quality Gates

**Priority:** HIGH
**Specs:** `specs/phase-2/test-validation.md`, `specs/phase-2/smart-retry.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Basic retry loop in `src/adw/agent/executor.py` (`prompt_with_retry()`)
- `RetryCode` enum in `src/adw/agent/models.py`
- Complete testing module (`src/adw/testing/`)
- Complete retry module (`src/adw/retry/`)
- **Integrated SDLC workflow** with test validation (`src/adw/workflows/sdlc.py`)

### Test Validation Tasks

- [x] **P2-1** Create `src/adw/testing/detector.py`
  - Detect: pytest, jest, vitest, npm test, bun test, go test, cargo test
  - Check config files: pytest.ini, package.json, vitest.config.ts, etc.
  - Return framework name and test command
  - **Files:** `src/adw/testing/detector.py`

- [x] **P2-2** Create `src/adw/testing/runner.py`
  - `run_tests(command: str) -> TestResult`
  - Run via subprocess with 5-minute timeout
  - Capture stdout/stderr, parse exit codes
  - Framework-specific output parsing
  - **Files:** `src/adw/testing/runner.py`

- [x] **P2-3** Create `TestResult` dataclass
  - Fields: passed, failed, skipped, errors counts
  - Failed test names and error messages with `FailedTest` dataclass
  - Coverage percentage (optional)
  - Support pytest, jest, vitest, go test, cargo test output formats
  - `to_retry_context()` method for retry integration
  - **Files:** `src/adw/testing/models.py`

- [x] **P2-4** Integrate test execution into SDLC workflow
  - Created `ValidationConfig` with max_retries, timeout, skip_tests options
  - `validate_tests()` for single-shot validation
  - `validate_with_retry()` for callback-based retry handling
  - Generates retry context for failed tests
  - **Files:** `src/adw/testing/validation.py`

- [x] **P2-5** Add test results to task completion
  - `TestResult.summary()` returns "Tests: X passed, Y failed, Z skipped (duration)"
  - `TestResult.format_failures()` lists failed test names
  - `get_test_report()` for formatted reports
  - **Files:** `src/adw/testing/models.py`, `src/adw/testing/validation.py`

### Smart Retry Tasks

- [x] **P2-6** Create `src/adw/retry/context.py`
  - `build_retry_context(error, phase, attempt_number, max_attempts, strategy)` -> str
  - Format errors with phase, message, instruction
  - `_truncate_stack_trace()` to prevent token overflow
  - `RetryContext` dataclass for structured context
  - **Files:** `src/adw/retry/context.py`

- [x] **P2-7** Add retry configuration
  - `ValidationConfig` with `max_retries` (default 3), `retry_delay_seconds` (default 2)
  - Exponential backoff support via `exponential_backoff` flag
  - **Files:** `src/adw/testing/validation.py`

- [x] **P2-8** Implement progressive retry strategies
  - `RetryStrategy` enum: SAME_APPROACH, ALTERNATIVE, SIMPLIFY
  - `select_retry_strategy()` selects strategy based on attempt number
  - Strategy-specific instructions in `_strategy_instructions()`
  - **Files:** `src/adw/retry/context.py`

- [x] **P2-9** Implement escalation protocol
  - `EscalationReport` dataclass with full report structure
  - `generate_escalation_report()` with pattern-based suggestions
  - `save_escalation_report()` writes to `agents/<task_id>/escalation.md`
  - `AttemptRecord` to track individual attempts
  - **Files:** `src/adw/retry/escalation.py`

- [x] **P2-10** Add retry logging
  - `AttemptRecord` captures: attempt_number, phase, error_message, strategy, duration, timestamp
  - Records passed to `ValidationResult` for history tracking
  - **Files:** `src/adw/retry/escalation.py`, `src/adw/testing/validation.py`

### Workflow Integration (NEW)

- [x] **P2-11** Integrate testing module into SDLC workflow TEST phase
  - `run_test_validation()` function calls testing module after TEST phase
  - Automatic test framework detection and execution
  - Test results stored in `PhaseResult.test_result`
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-12** Add retry context injection to implement phase
  - `execute_phase_with_retry()` supports injecting error context into prompts
  - After test failures, IMPLEMENT phase re-runs with formatted context
  - Progressive retry strategies (SAME_APPROACH → ALTERNATIVE → SIMPLIFY)
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-13** Wire up escalation report generation
  - When all test retries exhausted, generates `agents/{adw_id}/escalation.md`
  - Includes all attempt records with strategies and durations
  - Pattern-based suggestions for common errors
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-14** Add CLI options for test validation
  - `--no-test-validation` flag to disable automatic test validation
  - `--test-retries N` to configure max implement-test cycles (default: 3)
  - **Files:** `src/adw/workflows/sdlc.py`

### Tests Added
- `tests/test_testing.py` - 42 tests for testing module
- `tests/test_retry.py` - 21 tests for retry module
- All 298 tests pass after workflow integration

---

## Phase 3: Context Engineering

**Priority:** MEDIUM
**Specs:** `specs/phase-3/context-priming.md`, `specs/phase-3/context-bundles.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete priming commands: `/prime`, `/prime_feature`, `/prime_bug`, `/prime_test`, `/prime_docs`
- Complete context module in `src/adw/context/` with priming and bundles
- CLI commands: `adw prime generate/show/refresh`, `adw bundle list/show/diff/suggest/load/save/delete/compress`
- 48 tests for context module

### Context Priming Tasks

- [x] **P3-1** Create `.claude/commands/prime_bug.md`
  - Error handling patterns, logging, debug techniques
  - Failure modes and recovery patterns
  - **Files:** `.claude/commands/prime_bug.md`

- [x] **P3-2** Create `.claude/commands/prime_test.md`
  - Test locations, mocking patterns, coverage requirements
  - Test framework conventions
  - **Files:** `.claude/commands/prime_test.md`

- [x] **P3-3** Create `.claude/commands/prime_docs.md`
  - Doc locations, style guide, example documentation
  - **Files:** `.claude/commands/prime_docs.md`

- [x] **P3-4** Expand `/prime_feature` (was minimal ~31 lines)
  - Now comprehensive with component patterns, testing conventions, PR checklist
  - Expanded from 31 to 254 lines
  - **Files:** `.claude/commands/prime_feature.md`

- [x] **P3-5** Create `adw prime` CLI command
  - `adw prime generate` - Auto-generate priming commands based on detected project type
  - Support: Python, Node.js, Go, Rust, TypeScript, React, Vue, Next.js, FastAPI, Django, Flask
  - Creates `.claude/commands/*_auto.md` dynamically
  - **Files:** `src/adw/context/priming.py`, `src/adw/cli.py`

- [x] **P3-6** Add `adw prime --refresh` for regeneration
  - `adw prime refresh` regenerates all auto-generated priming commands
  - `adw prime show` displays detected project info
  - Note: Deep Claude analysis (--deep) not yet implemented
  - **Files:** `src/adw/cli.py`

### Context Bundles Tasks

- [x] **P3-7** Create `src/adw/context/bundles.py`
  - `save_bundle(task_id: str, files: list)` - Persist bundles
  - `load_bundle(task_id: str) -> Bundle` - Retrieve bundles
  - `list_bundles()`, `delete_bundle()`, `get_bundle_file_contents()`
  - Store in `.adw/bundles/` directory
  - Excludes binary files, supports JSON and compressed formats
  - **Files:** `src/adw/context/bundles.py`, `src/adw/context/__init__.py`

- [x] **P3-8** Add `/load_bundle <task_id>` Claude command
  - Updated existing `/load_bundle` command to work with new bundle system
  - Display files, support for bundle operations
  - **Files:** `.claude/commands/load_bundle.md`

- [x] **P3-9** Add `adw bundle` CLI commands
  - `adw bundle load <task_id>` - Load bundle and show files
  - `adw bundle diff <task1> <task2>` - Show files added/removed/changed
  - `adw bundle list` - List all bundles
  - `adw bundle show <task_id>` - Show bundle details
  - `adw bundle save <task_id> <files...>` - Manually save bundle
  - `adw bundle delete <task_id>` - Delete bundle
  - **Files:** `src/adw/cli.py`

- [x] **P3-10** Implement smart bundle selection
  - `adw bundle suggest "description"` - Find similar past task bundles
  - Ranks by keyword matching in description, tags, and file paths
  - Returns top N bundles with relevance scores
  - **Files:** `src/adw/context/bundles.py`

- [x] **P3-11** Add bundle compression for old bundles (>7 days)
  - `adw bundle compress --days N` compresses bundles older than N days
  - Uses gzip compression for storage efficiency
  - **Files:** `src/adw/context/bundles.py`, `src/adw/cli.py`

### Tests Added
- `tests/test_context.py` - 48 tests covering:
  - Project type detection (14 tests)
  - Prime command generation (7 tests)
  - Bundle data structures (6 tests)
  - Bundle save/load (7 tests)
  - Bundle list/diff/suggest (6 tests)
  - Bundle file contents and compression (6 tests)
  - Bundle deletion (3 tests)

---

## Phase 4: Feedback Loops

**Priority:** MEDIUM
**Specs:** `specs/phase-4/pr-review-integration.md`, `specs/phase-4/human-in-loop.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete github module (`src/adw/github/`)
- PR review watcher with state persistence
- Comment parser with 20+ actionable patterns
- Auto-fix system with batch commits
- Approval gate system with TTL and expiration
- CLI commands for all operations

### PR Review Integration Tasks

- [x] **P4-1** Create `src/adw/github/review_watcher.py`
  - `PRReviewWatcher` class with state file persistence
  - `get_pr_review_comments()` polls inline and issue comments
  - `get_pr_status()` fetches PR info including approval status
  - Tracks seen comment IDs to prevent duplicates
  - **Files:** `src/adw/github/review_watcher.py`

- [x] **P4-2** Implement comment parser
  - `parse_review_comment()` with 20+ actionable patterns
  - Detects: change requests, add requests, fix requests, suggestions
  - Extracts `suggestion` code blocks as suggested changes
  - Filters: approvals (LGTM, emojis), questions, ADW-generated comments
  - Priority levels: HIGH, MEDIUM, LOW based on pattern
  - **Files:** `src/adw/github/comment_parser.py`

- [x] **P4-3** Implement auto-fix from comments
  - `AutoFixer` class with Claude Code integration
  - Builds context-rich prompts with file/line info
  - Single commit or batch commit modes
  - Dry run support
  - **Files:** `src/adw/github/auto_fix.py`

- [x] **P4-4** Add reviewer notification
  - `reply_to_comment()` replies to specific comment threads
  - `notify_reviewer()` posts fix confirmation with commit hash
  - ADW marker in comments prevents loops
  - **Files:** `src/adw/github/review_watcher.py`, `src/adw/github/auto_fix.py`

- [x] **P4-5** Add approval detection
  - `PRReviewWatcher.is_approved()` checks reviewDecision
  - `PRReviewWatcher.is_changes_requested()` detects requested changes
  - PR status tracking: OPEN, CLOSED, MERGED, DRAFT
  - **Files:** `src/adw/github/review_watcher.py`

### Human-in-the-Loop Tasks

- [x] **P4-6** Add `awaiting_review` task status
  - Added `AWAITING_REVIEW` to `TaskStatus` enum
  - **Files:** `src/adw/agent/models.py`

- [x] **P4-7** Create plan approval gate
  - `ApprovalRequest` dataclass with full state
  - `ApprovalGate` class for workflow integration
  - Generates `agents/<task_id>/APPROVAL_REQUEST.md`
  - 24-hour TTL with automatic expiration check
  - **Files:** `src/adw/github/approval_gate.py`

- [x] **P4-8** Add CLI commands: `adw approve-task`, `adw reject-task`
  - `adw approve-task <task_id>` approves pending requests
  - `adw reject-task <task_id> --reason "..."` rejects with feedback
  - `adw pending-approvals` lists all pending requests
  - **Files:** `src/adw/cli.py`

- [x] **P4-9** Add continue prompts: `adw continue-task <task_id> "feedback"`
  - Stores feedback history with timestamps
  - `get_approval_context()` injects feedback into prompts
  - Tracks phase context for each prompt
  - **Files:** `src/adw/github/approval_gate.py`, `src/adw/cli.py`

- [x] **P4-10** Add configuration options
  - `ApprovalGate.enabled` flag for enabling/disabling
  - `ApprovalGate.auto_approve_low_risk` for auto-approving low risk tasks
  - Environment variable: `ADW_AUTO_APPROVE=1` disables gates
  - **Files:** `src/adw/github/approval_gate.py`

### CLI Commands Added
- `adw github watch-pr <pr>` - Watch PR for review comments
- `adw github fix-comments <pr>` - Fix actionable review comments
- `adw approve-task <task_id>` - Approve pending task
- `adw reject-task <task_id> -r <reason>` - Reject with reason
- `adw continue-task <task_id> <feedback>` - Add iterative feedback
- `adw pending-approvals` - List pending approval requests

### Tests Added
- `tests/test_github.py` - 44 tests covering:
  - ReviewComment serialization (3 tests)
  - PRInfo serialization (1 test)
  - PRReviewWatcher state management (4 tests)
  - Comment parser patterns (11 tests)
  - FixResult status (2 tests)
  - AutoFixer prompt building (3 tests)
  - ApprovalRequest lifecycle (5 tests)
  - Approval functions (8 tests)
  - ApprovalGate configuration (5 tests)
  - ContinuePrompt serialization (2 tests)

---

## Phase 5: Specialized Agents

**Priority:** MEDIUM
**Specs:** `specs/phase-5/agent-experts.md`, `specs/phase-5/self-improving.md`, `specs/phase-5/specialized-planners.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- `/experts:cc_expert` and `/experts:cc_expert:improve` commands
- `/plan_vite_vue` specialized planner (696 lines, comprehensive)
- Complete expert module in `src/adw/experts/`
- Expert auto-selection system with keyword and file pattern matching
- Complete learning module in `src/adw/learning/`
- Pattern store with persistence at `~/.adw/learning/`
- Expertise section injection into SDLC workflow prompts
- `/improve` command for extracting learnings
- `adw learn` CLI commands (show, stats, export, import, add, clear, report)
- **NEW:** `/plan_fastapi` - FastAPI API-first planner
- **NEW:** `/plan_react` - React component-first planner
- **NEW:** `/plan_nextjs` - Next.js full-stack planner (SSR/SSG, App Router)
- **NEW:** `/plan_supabase` - Supabase database-first planner (RLS, Edge Functions)
- **NEW:** `adw plan` CLI with auto-detect planner selection
- 111 tests for expert + learning + planner modules

### Expert Framework Tasks

- [x] **P5-1** Create `src/adw/experts/base.py`
  - Base `Expert` class with: `domain`, `knowledge`, `plan()`, `build()`, `improve()`
  - `ExpertKnowledge` dataclass with patterns, best_practices, known_issues, learnings
  - Knowledge persistence at `~/.adw/experts/<name>/knowledge.json`
  - `register_expert`, `get_expert`, `list_experts` registry functions
  - **Files:** `src/adw/experts/base.py`, `src/adw/experts/__init__.py`

- [x] **P5-2** Create `src/adw/experts/frontend.py`
  - Focus: React, Vue, CSS, accessibility
  - Default best practices and patterns for frontend development
  - Framework-specific guidance (React vs Vue)
  - Accessibility checklist in plans
  - **Files:** `src/adw/experts/frontend.py`

- [x] **P5-3** Create `src/adw/experts/backend.py`
  - Focus: FastAPI, Supabase, REST APIs, Django, Flask
  - Default best practices for API design and database operations
  - Framework-specific guidance (FastAPI vs Django vs Flask)
  - **Files:** `src/adw/experts/backend.py`

- [x] **P5-4** Create `src/adw/experts/ai.py`
  - Focus: LLM integration, prompts, agents, RAG
  - Use-case specific guidance (agent, RAG, chatbot, general)
  - Default best practices for prompt engineering and error handling
  - **Files:** `src/adw/experts/ai.py`

- [x] **P5-5** Implement expert auto-selection
  - `select_experts()` with keyword and file pattern matching
  - 20+ keyword patterns per domain with confidence scores
  - 10+ file patterns per domain
  - Multi-expert collaboration support
  - `ExpertMatch` dataclass with score and reasons
  - `detect_domain_from_path()` helper function
  - **Files:** `src/adw/experts/selector.py`

### Self-Improving Tasks

- [x] **P5-6** Add `## Expertise` section to agent prompts
  - `inject_expertise_into_prompt()` adds expertise to PLAN and IMPLEMENT phases
  - Combines expert knowledge with project-specific learnings
  - Auto-injects patterns, issues, best practices, mistakes to avoid
  - **Files:** `src/adw/learning/expertise.py`, `src/adw/workflows/sdlc.py`

- [x] **P5-7** Create `/improve` command
  - Analyzes recent task execution for learnings
  - Prompts for patterns, issues, and insights
  - Records to `~/.adw/learning/<project>/patterns.json`
  - **Files:** `.claude/commands/improve.md`

- [x] **P5-8** Implement pattern learning
  - `Learning` dataclass with type, content, domain, success_count
  - `PatternStore` for persistence and retrieval
  - `extract_learnings_from_feedback()` with 20+ regex patterns
  - `record_task_outcome()` for automatic learning from tasks
  - Supports: patterns, issues, best_practices, mistakes
  - **Files:** `src/adw/learning/patterns.py`

- [x] **P5-9** Add `adw learn` CLI
  - `adw learn show` - View learnings with filtering
  - `adw learn stats` - Statistics on accumulated learnings
  - `adw learn export` / `adw learn import` - Share learnings
  - `adw learn add` - Manually add learnings
  - `adw learn clear` - Clear learnings
  - `adw learn report` - Generate full expertise report
  - **Files:** `src/adw/cli.py`

### Specialized Planners Tasks

- [x] **P5-10** Create `.claude/commands/plan_fastapi.md`
  - Router patterns, Pydantic models, dependency injection
  - API-first planning with OpenAPI schema considerations
  - Middleware, background tasks, error handling patterns
  - **Files:** `.claude/commands/plan_fastapi.md`

- [x] **P5-11** Create `.claude/commands/plan_react.md`
  - Component hierarchy, state management, hooks
  - Component-first planning with Zustand/Context patterns
  - Performance optimization (memo, lazy loading)
  - Testing with React Testing Library
  - **Files:** `.claude/commands/plan_react.md`

- [x] **P5-12** Create `.claude/commands/plan_nextjs.md`
  - App Router vs Pages Router, Server Components
  - SSR/SSG/ISR considerations with caching strategies
  - Server Actions, middleware, streaming
  - **Files:** `.claude/commands/plan_nextjs.md`

- [x] **P5-13** Create `.claude/commands/plan_supabase.md`
  - PostgreSQL schema, Row Level Security, Edge Functions
  - Database-first planning with RLS policies
  - Realtime subscriptions, storage, type generation
  - **Files:** `.claude/commands/plan_supabase.md`

- [x] **P5-14** Implement auto-detect planner in `adw plan`
  - `adw plan` CLI command with auto-detection
  - Detect from: pyproject.toml, package.json, requirements.txt
  - Maps: FastAPI/Django/Flask → fastapi, React → react, Next.js → nextjs, Vue → vue
  - Supabase detection from dependencies
  - Fallback to generic planner
  - `--planner` option for manual override
  - `--show` option to see detection without running
  - **Files:** `src/adw/cli.py`

### Tests Added
- `tests/test_experts.py` - 49 tests covering:
  - ExpertKnowledge dataclass (10 tests)
  - FrontendExpert functionality (6 tests)
  - BackendExpert functionality (5 tests)
  - AIExpert functionality (5 tests)
  - Expert registry (5 tests)
  - Expert auto-selection (8 tests)
  - Domain detection from paths (5 tests)
  - Expert stats (1 test)
  - Integration tests (2 tests)
  - File-based expert selection (2 tests)

- `tests/test_learning.py` - 38 tests covering:
  - Learning dataclass (5 tests)
  - LearningType enum (1 test)
  - PatternStore CRUD (8 tests)
  - TaskOutcome serialization (1 test)
  - Learning extraction from feedback (6 tests)
  - Domain detection from files (4 tests)
  - Expertise section building (4 tests)
  - Expertise injection (2 tests)
  - Combined expertise (2 tests)
  - Record outcome (3 tests)
  - Integration tests (2 tests)

- `tests/test_planners.py` - 24 tests covering:
  - Planner file existence (6 tests)
  - Planner metadata and content (4 tests)
  - Auto-detection for project types (6 tests)
  - Planner mapping (3 tests)
  - Content quality validation (5 tests)

---

## Phase 6: Multi-Repo Orchestration

**Priority:** LOW
**Spec:** `specs/phase-6/multi-repo.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete workspace module in `src/adw/workspace/`
- Full TOML configuration persistence at `~/.adw/workspace.toml`
- All CLI workspace commands implemented
- Cross-repo task queue with dependency resolution
- Unified context for agents with API contract detection
- Comprehensive test suite (88 tests passing)

### Tasks

- [x] **P6-1** Create workspace configuration `~/.adw/workspace.toml`
  - `WorkspaceConfig` dataclass with multiple workspaces support
  - `Workspace` container with repos and relationships
  - `RepoConfig` with name, path, type, branch, workflow, enabled status
  - `Relationship` for inter-repo dependencies (depends_on, integrates_with)
  - Auto-type detection (nextjs, fastapi, react, vue, django, flask, go, rust, etc.)
  - TOML serialization with `tomli`/`tomli_w` (fallback writer if unavailable)
  - **Files:** `src/adw/workspace/config.py`

- [x] **P6-2** Add CLI: `adw workspace init`, `adw workspace add <path>`
  - `adw workspace init [name] [-d description]` - Initialize workspace
  - `adw workspace add <path> [-n name] [-t type]` - Add repo with auto-detection
  - `adw workspace remove <name>` - Remove repo and cleanup relationships
  - `adw workspace list [-v]` - List repos with verbose option
  - `adw workspace show` - Display active workspace details
  - `adw workspace switch <name>` - Change active workspace
  - `adw workspace depend <source> <target> [--type type]` - Add relationship
  - `adw workspace undepend <source> <target>` - Remove relationship
  - **Files:** `src/adw/cli.py` (lines 3917-4246)

- [x] **P6-3** Implement cross-repo task queue
  - `CrossRepoTask` wraps Task with repo context
  - `WorkspaceTaskQueue` indexes tasks by full_id and repo
  - `load_workspace_tasks()` loads from all repo `tasks.md` files
  - `parse_task_spec()` handles "{repo: frontend}" and "frontend:" formats
  - `detect_repo_from_path()` auto-detects repo from file paths
  - `add_cross_repo_task()` adds tasks to specific repo
  - `queue.summary()` returns stats by status and repo
  - **Files:** `src/adw/workspace/tasks.py`

- [x] **P6-4** Add task dependency support
  - `CrossRepoDependency` dataclass with parse() method
  - Format: "repo:task_id" for cross-repo, "task_id" for same-repo
  - `get_actionable()` respects both local and cross-repo deps
  - `get_blocked_reason()` explains why task is blocked
  - Tasks auto-unblock when dependencies complete
  - **Files:** `src/adw/workspace/tasks.py`

- [x] **P6-5** Implement unified context
  - `RepoContext` loads documentation (CLAUDE.md, README.md, ARCHITECTURE.md)
  - `WorkspaceContext` aggregates all repo contexts
  - `read_file_from_workspace()` reads files from any repo
  - `get_api_contracts()` extracts OpenAPI, TypeScript types, Python schemas
  - `build_workspace_prompt_context()` generates formatted prompt section
  - Detects shared patterns across repos
  - **Files:** `src/adw/workspace/context.py`

- [x] **P6-6** Add coordinated PRs
  - `LinkedPR` dataclass for PR metadata (owner, repo, number, state, approved, mergeable)
  - `PRLinkGroup` for managing linked PR groups with atomic merge support
  - `LinkStatus` enum: PENDING, READY, PARTIAL, MERGED, FAILED, CANCELLED
  - `MergeResult` dataclass for merge operation results
  - Storage persistence at `~/.adw/pr_links.json`
  - `parse_pr_url()` supports: full URL, owner/repo#N, #N (current repo)
  - `create_link_group()` creates group and updates PR descriptions with cross-refs
  - `get_link_group()`, `list_link_groups()`, `refresh_link_group()`
  - `merge_link_group()` with atomic rollback on failure
  - `unlink_prs()` to cancel link groups
  - CLI commands:
    - `adw pr link <pr1> <pr2> [-d desc] [--no-atomic]` - Link PRs
    - `adw pr list [--all]` - List link groups
    - `adw pr show <id> [--refresh]` - Show group details
    - `adw pr merge <id> [--method squash|merge|rebase] [--force]` - Merge all
    - `adw pr unlink <id> [-y]` - Cancel link group
  - **Files:** `src/adw/github/pr_linker.py`, `src/adw/cli.py`

### Tests Added
- `tests/test_workspace.py` - 88 tests covering:
  - RepoConfig creation, serialization, path resolution (9 tests)
  - Relationship dataclass (4 tests)
  - Workspace repo management and dependencies (15 tests)
  - WorkspaceConfig multi-workspace management (10 tests)
  - Save/load TOML persistence (2 tests)
  - Helper functions (7 tests)
  - Type detection (5 tests)
  - CrossRepoTask and CrossRepoDependency (7 tests)
  - WorkspaceTaskQueue with dependency resolution (6 tests)
  - Task parsing and repo detection (6 tests)
  - Add cross-repo task (3 tests)
  - Context loading and file reading (9 tests)
  - API contract extraction (2 tests)
  - Prompt context building (3 tests)

- `tests/test_pr_linker.py` - 27 tests covering:
  - LinkedPR creation and serialization (4 tests)
  - PRLinkGroup management (10 tests)
  - LinkStatus enum values (1 test)
  - MergeResult dataclass (3 tests)
  - parse_pr_url() parsing (5 tests)
  - Storage save/load (2 tests)
  - Integration tests (2 tests)

---

## Phase 7: Entry Points

**Priority:** LOW
**Spec:** `specs/phase-7/entry-points.md`
**Status:** ✅ COMPLETE (100%) - GitHub + Webhook + Notion + Slack + Linear

### What Exists
- GitHub issues integration (`src/adw/integrations/github.py`)
- GitHub trigger polling (`src/adw/triggers/github.py`)
- **NEW:** Issue template parser (`src/adw/integrations/issue_parser.py`)
  - YAML frontmatter parsing (type, priority, workflow, model, tags)
  - Markdown section parsing (description, steps to reproduce, etc.)
  - Inline tag extraction ({opus}, {sdlc}, {p0})
  - Label-based configuration (workflow:sdlc, model:opus)
- **NEW:** Label-based workflow selection in webhooks and triggers
- **NEW:** Generic webhook API with full authentication (`src/adw/triggers/webhook.py`)
- **NEW:** API key management (generate, verify, revoke, disable)
- **NEW:** Rate limiting per API key (100 req/hour default, configurable)
- **NEW:** Callback URL registration for task completion
- **NEW:** Webhook activity logging to `.adw/webhooks.jsonl`
- **NEW:** Complete Notion integration (`src/adw/integrations/notion.py`)
  - `NotionConfig` and `NotionTask` dataclasses
  - `NotionClient` for API calls (urllib-based, no external dependencies)
  - `NotionWatcher` for database polling with filter support
  - Property parsing for all Notion property types
  - Bidirectional sync (ADW status written back to Notion)
  - ADW ID tracking to prevent duplicate processing
  - CLI commands: `adw notion watch`, `adw notion test`, `adw notion process`
- **NEW:** Complete Slack integration (`src/adw/integrations/slack.py`)
  - `SlackConfig` and `SlackClient` classes (urllib-based, no external dependencies)
  - Slash commands: `/adw create`, `/adw status`, `/adw approve`, `/adw reject`
  - Thread-based progress updates
  - Button interactions for approve/reject with modal dialogs
  - Request signature verification for security
  - State persistence for task-to-thread mapping
  - CLI commands: `adw slack start`, `adw slack test`, `adw slack send`, `adw slack notify`
- **NEW:** Complete Linear integration (`src/adw/integrations/linear.py`)
  - `LinearConfig` and `LinearClient` classes (urllib-based GraphQL, no external dependencies)
  - `LinearIssue` and `LinearWatcher` for issue polling
  - GraphQL API client with rate limiting and caching
  - Bidirectional sync: Linear issue state ↔ ADW task status
  - ADW ID tracking in issue description to prevent duplicate processing
  - Comments posted for task start/complete/fail events
  - Label-based workflow/model selection (`workflow:sdlc`, `model:opus`)
  - Priority mapping (Linear priority 1-4 → ADW p0-p3)
  - Auto-detect team if not configured
  - CLI commands: `adw linear watch`, `adw linear test`, `adw linear process`, `adw linear sync`
- Cron daemon fully functional

### GitHub Enhancement Tasks

- [x] **P7-1** Add issue template parsing
  - `ParsedIssueTemplate` dataclass with all template fields
  - `parse_yaml_frontmatter()` extracts YAML metadata
  - `parse_markdown_sections()` extracts markdown headers
  - `extract_inline_tags()` finds {opus}, {sdlc}, etc. in text
  - `merge_template_with_labels()` combines template with GitHub labels
  - **Files:** `src/adw/integrations/issue_parser.py`

- [x] **P7-2** Implement label-based workflow selection
  - Labels `workflow:simple`, `workflow:standard`, `workflow:sdlc` select workflow
  - Labels `model:sonnet`, `model:opus`, `model:haiku` select model
  - Labels `priority:p0`, `priority:p1`, etc. set priority
  - Direct labels (`sdlc`, `opus`, `bug`) also work
  - Updated `webhook.py` and `triggers/github.py` to use issue parser
  - **Files:** `src/adw/triggers/webhook.py`, `src/adw/triggers/github.py`

### Notion Integration Tasks

- [x] **P7-3** Create `src/adw/integrations/notion.py`
  - `NotionConfig` with env var and config file support
  - `NotionTask` dataclass with workflow/model/priority extraction
  - `NotionClient` API client using urllib (no external dependencies)
  - `NotionWatcher` for database polling with status filtering
  - Property parsing for all Notion types (title, text, select, status, etc.)
  - Bidirectional sync: ADW status updates written back to Notion
  - ADW ID tracking to prevent duplicate task processing
  - Priority text mapping (Critical→p0, High→p1, etc.)
  - **Files:** `src/adw/integrations/notion.py`

- [x] **P7-4** Add `adw notion watch` CLI
  - `adw notion watch` - Continuous polling with configurable interval
  - `adw notion test` - Test connection and list database pages
  - `adw notion process` - One-shot processing for cron integration
  - Environment variable configuration (NOTION_API_KEY, NOTION_DATABASE_ID)
  - Config file support (`~/.adw/config.toml` [notion] section)
  - **Files:** `src/adw/cli.py`

### Slack Integration Tasks

- [x] **P7-5** Create `src/adw/integrations/slack.py`
  - `SlackConfig` with env var and config file support
  - `SlackClient` API client using urllib (no external dependencies)
  - Request signature verification for security
  - Slash commands: `/adw create`, `/adw status`, `/adw approve`, `/adw reject`, `/adw help`
  - `SlashCommandRequest` and `InteractionPayload` dataclasses
  - Thread-based progress updates with `send_thread_update()`
  - Button interactions for approve/reject with modal dialogs
  - Message formatting for started/completed/failed/approval notifications
  - State persistence for task-to-thread mapping (`~/.adw/slack_state.json`)
  - FastAPI app for webhook endpoints (`/slack/commands`, `/slack/interactions`, `/slack/events`)
  - CLI commands: `adw slack start`, `adw slack test`, `adw slack send`, `adw slack notify`
  - **Files:** `src/adw/integrations/slack.py`, `src/adw/cli.py`

### Linear Integration Tasks

- [x] **P7-6** Create `src/adw/integrations/linear.py`
  - `LinearConfig` with env var and config file support
  - `LinearIssue` dataclass with workflow/model/priority extraction
  - `LinearClient` GraphQL API client using urllib (no external dependencies)
  - `LinearWatcher` for issue polling with state filtering
  - Team and workflow state caching for performance
  - Rate limiting with Retry-After header support
  - ADW ID tracking in issue description
  - Comments for task lifecycle events (start/complete/fail)
  - Label-based workflow selection (`workflow:sdlc`, `model:opus`)
  - Priority mapping (Linear 1=urgent→p0, 2=high→p1, etc.)
  - **Files:** `src/adw/integrations/linear.py`

- [x] **P7-7** Add `adw linear` CLI commands
  - `adw linear watch` - Continuous polling with configurable interval
  - `adw linear test` - Test connection and list accessible teams
  - `adw linear process` - One-shot processing for cron integration
  - `adw linear sync <identifier>` - Sync specific issue by ID
  - Environment variable configuration (LINEAR_API_KEY, LINEAR_TEAM_ID)
  - Config file support (`~/.adw/config.toml` [linear] section)
  - **Files:** `src/adw/cli.py`, `src/adw/integrations/__init__.py`

### Webhook Enhancement Tasks

- [x] **P7-8** Add generic `/api/tasks` endpoint (not just GitHub-specific)
  - Accept JSON: description, workflow, repo, priority, tags, callback_url, model
  - API key authentication via Bearer token
  - Rate limiting (configurable per key)
  - Return task ID and status
  - Full request validation
  - `/api/tasks/{task_id}` GET endpoint for status check
  - **Files:** `src/adw/triggers/webhook.py`, `src/adw/cli.py`

- [x] **P7-9** Add callback URL for task completion notifications
  - `register_callback()` stores callback URLs
  - `send_callback()` POSTs completion payload
  - Automatic cleanup after successful delivery
  - **Files:** `src/adw/triggers/webhook.py`

### CLI Commands Added
- `adw webhook start [--port] [--host] [--reload]` - Start webhook server
- `adw webhook logs [-n] [-k key_id] [-f]` - View webhook activity
- `adw webhook key generate <name> [-r rate_limit] [-e expires_days]` - Generate API key
- `adw webhook key list [-a]` - List API keys
- `adw webhook key revoke <key_id> [-y]` - Permanently revoke key
- `adw webhook key disable <key_id>` - Disable key temporarily
- `adw webhook key enable <key_id>` - Re-enable disabled key
- `adw slack start [--port] [--host] [--reload]` - Start Slack webhook server
- `adw slack test` - Test Slack connection
- `adw slack send <channel> <message>` - Send test message
- `adw slack notify <adw_id> [--event] [--error] [--pr-url]` - Notify task thread
- `adw linear watch [--interval] [--dry-run] [--team-id]` - Watch Linear for issues
- `adw linear test` - Test Linear connection and list teams
- `adw linear process [--dry-run]` - Process pending issues once
- `adw linear sync <identifier> [--dry-run]` - Sync specific issue by ID

### Tests Added
- `tests/test_webhook.py` - 56 tests covering:
  - API key creation, verification, expiration (6 tests)
  - API key management (14 tests)
  - Rate limiting (4 tests)
  - Task create request/response models (11 tests)
  - Callback registration (3 tests)
  - Webhook logging (5 tests)
  - GitHub event handling (6 tests)
  - FastAPI integration (8 tests, skipped if fastapi not installed)

- `tests/test_issue_parser.py` - 48 tests covering:
  - IssueType and Priority enums (2 tests)
  - ParsedIssueTemplate dataclass (9 tests)
  - YAML frontmatter parsing (8 tests)
  - Markdown section parsing (5 tests)
  - Inline tag extraction (5 tests)
  - Label configuration extraction (6 tests)
  - Template merging with labels (3 tests)
  - Full issue body parsing (7 tests)
  - Integration tests (3 tests)

- `tests/test_notion.py` - 44 tests covering:
  - Status mapping (2 tests)
  - NotionConfig creation and loading (9 tests)
  - NotionTask dataclass (7 tests)
  - Property parsing for all types (11 tests)
  - Page parsing (5 tests)
  - Property building (2 tests)
  - NotionWatcher filter building (3 tests)
  - NotionClient API calls (4 tests)
  - Helper functions (2 tests)
  - Integration tests (2 tests)

- `tests/test_slack.py` - 41 tests covering:
  - SlackConfig creation and loading (8 tests)
  - Request signature verification (4 tests)
  - SlashCommandRequest parsing (6 tests)
  - InteractionPayload parsing (2 tests)
  - Message formatting (9 tests)
  - Slash command handling (2 tests)
  - State management (4 tests)
  - SlackClient API calls (5 tests)
  - Helper functions (1 test)

- `tests/test_linear.py` - 49 tests covering:
  - Status mapping (5 tests)
  - LinearConfig creation and loading (9 tests)
  - LinearIssue dataclass (12 tests)
  - Issue parsing from API responses (5 tests)
  - LinearClient GraphQL requests (8 tests)
  - LinearWatcher polling and processing (6 tests)
  - Helper functions (3 tests)
  - Integration tests (2 tests)

### Telegram Bot (BONUS)

- [ ] **P7-10** Create `src/adw/integrations/telegram.py`
  - Commands: `/task`, `/status`, `/approve`

---

## Phase 8: Failure Recovery

**Priority:** MEDIUM
**Spec:** `specs/phase-8/failure-recovery.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete recovery module (`src/adw/recovery/`)
- Error classification system with 50+ patterns
- Four recovery strategies with orchestration
- Checkpoint system with persistence
- WIP commit support for partial progress
- CLI commands: `adw rollback`, `adw resume-task`, `adw checkpoints`, `adw escalation`
- Comprehensive test suite (113 tests)

### Tasks

- [x] **P8-1** Create `src/adw/recovery/classifier.py`
  - Classify errors: `retriable` (network/timeout), `fixable` (test/lint), `fatal` (config/deps), `unknown`
  - 50+ regex patterns for error classification
  - Confidence scoring and suggested actions
  - Helper functions: `is_retriable()`, `is_fixable()`, `is_fatal()`
  - **Files:** `src/adw/recovery/classifier.py`

- [x] **P8-2** Implement recovery strategies
  - `RetryRecoveryStrategy` - Simple retry with exponential backoff
  - `FixRecoveryStrategy` - Auto-fix based on error classification
  - `SimplifyRecoveryStrategy` - Reduce task scope on final attempt
  - `EscalateRecoveryStrategy` - Escalate to human with notification callback
  - `RecoveryOrchestrator` - Higher-level orchestration across strategies
  - `select_recovery_strategy()` - Intelligent strategy selection
  - **Files:** `src/adw/recovery/strategies.py`

- [x] **P8-3** Add partial commit system
  - `create_wip_commit()` - Commit working changes with `[WIP]` prefix
  - Track staged vs unstaged changes
  - Include ADW ID in commit message
  - **Files:** `src/adw/recovery/checkpoints.py`

- [x] **P8-4** Create `src/adw/recovery/checkpoints.py`
  - `Checkpoint` dataclass with full state serialization
  - `CheckpointManager` class for session management
  - Functions: `save_checkpoint()`, `load_checkpoint()`, `list_checkpoints()`
  - `get_last_checkpoint()`, `get_last_successful_checkpoint()`
  - `clear_old_checkpoints()` for cleanup (configurable days)
  - Git commit tracking in checkpoints
  - **Files:** `src/adw/recovery/checkpoints.py`

- [x] **P8-5** Add rollback capability
  - `adw rollback <task_id>` - Undo all task changes
  - `rollback_to_checkpoint()` - Reset to specific checkpoint
  - `rollback_all_changes()` - Undo all task changes
  - Git reset integration
  - Task status update to "failed"
  - **Files:** `src/adw/recovery/checkpoints.py`, `src/adw/cli.py`

- [x] **P8-6** Generate escalation reports
  - Already implemented in Phase 2 (`src/adw/retry/escalation.py`)
  - `adw escalation <task_id>` CLI command to view reports
  - **Files:** `src/adw/cli.py`

### CLI Commands Added
- `adw rollback <task_id>` - Rollback to last checkpoint or specific checkpoint
- `adw resume-task <task_id>` - Resume from last successful checkpoint
- `adw checkpoints <task_id>` - List all checkpoints for a task
- `adw escalation <task_id>` - View escalation report

### Tests Added
- `tests/test_recovery.py` - 113 tests covering:
  - Error classification (50+ test cases)
  - Recovery strategies (all 4 strategies)
  - Checkpoint persistence (save/load/list/delete)
  - WIP commit functionality

---

## Phase 9: Reporting & Analytics

**Priority:** LOW
**Spec:** `specs/phase-9/reporting.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete reports module (`src/adw/reports/`)
- Daily summary reports with task counts, commits, costs, time saved
- Weekly digest with week-over-week comparison
- Trend analysis with sparklines and anomaly detection
- Metrics database at `~/.adw/metrics.db`
- Notification system with Slack/Discord webhooks
- CLI commands: `adw report daily/weekly/trends/sparklines`, `adw metrics`, `adw costs`, `adw alerts`
- 61 tests for reports module

### Tasks

- [x] **P9-1** Create `src/adw/reports/daily.py`
  - `DailySummary` dataclass with all metrics
  - `generate_daily_summary()` function
  - `save_daily_summary()` to `.adw/reports/daily-{date}.md`
  - Anthropic pricing for cost estimation
  - Time saved estimation heuristics
  - **Files:** `src/adw/reports/daily.py`

- [x] **P9-2** Add `adw report daily` CLI
  - `adw report daily` - Generate today's summary
  - `adw report daily -d 2026-02-01` - Specific date
  - `adw report daily --save` - Save to file
  - `adw report daily --json` - JSON output
  - **Files:** `src/adw/cli.py`

- [x] **P9-3** Create weekly digest with trend analysis
  - `WeeklyDigest` dataclass with all metrics
  - `generate_weekly_digest()` aggregates daily summaries
  - Week-over-week comparison (tasks, cost, success rate)
  - Best/worst task identification
  - **Files:** `src/adw/reports/weekly.py`

- [x] **P9-4** Add `adw report weekly` CLI
  - `adw report weekly` - Current week's digest
  - `adw report weekly -d 2026-01-20` - Specific week
  - `adw report weekly --save` - Save to file
  - **Files:** `src/adw/cli.py`

- [x] **P9-5** Create metrics database `~/.adw/metrics.db`
  - `MetricsDB` class with SQLite backend
  - `TaskMetrics` dataclass with all task data
  - `PhaseMetrics` for per-phase tracking
  - Daily aggregates table for fast queries
  - Thread-safe connection pooling
  - **Files:** `src/adw/reports/metrics.py`

- [x] **P9-6** Add `adw metrics <task_id>` CLI
  - `adw metrics abc12345` - View specific task metrics
  - `adw metrics --summary` - Overall statistics
  - `adw metrics --recent 10` - Last N tasks
  - **Files:** `src/adw/cli.py`

- [x] **P9-7** Implement cost tracking
  - Anthropic pricing: Sonnet ($3/$15), Opus ($15/$75), Haiku ($0.25/$1.25)
  - Per-task cost calculation
  - Daily/weekly/monthly aggregation
  - **Files:** `src/adw/reports/daily.py`, `src/adw/reports/metrics.py`

- [x] **P9-8** Add `adw costs --period [week|month]` CLI
  - `adw costs` - This week's costs
  - `adw costs -p day` - Today's costs
  - `adw costs -p month` - Last 30 days
  - Cost breakdown by model tier
  - **Files:** `src/adw/cli.py`

- [x] **P9-9** Add trend analysis
  - `TrendAnalysis` dataclass with statistics
  - `TrendPoint` for individual data points
  - `TrendReport` with multiple metrics
  - Linear regression for trend direction
  - Z-score anomaly detection
  - Alert generation for declining metrics
  - **Files:** `src/adw/reports/trends.py`

- [x] **P9-10** Add TUI visualization with sparklines
  - `_generate_sparkline()` function (ASCII chars ▁▂▃▄▅▆▇█)
  - `get_sparkline_summary()` for compact display
  - `adw report sparklines` CLI command
  - `adw report trends` for full trend report
  - **Files:** `src/adw/reports/trends.py`, `src/adw/cli.py`

- [x] **P9-11** Add notification system
  - `NotificationChannel` dataclass (name, type, webhook, events)
  - `NotificationConfig` with JSON persistence
  - Slack/Discord webhook formatters
  - Event types: task_start, task_complete, task_failed, daily_summary, weekly_digest, anomaly
  - CLI commands: `adw alerts add/remove/list/test/enable`
  - **Files:** `src/adw/reports/notifications.py`, `src/adw/cli.py`

### Tests Added
- `tests/test_reports.py` - 61 tests covering:
  - DailySummary creation and formatting (6 tests)
  - Daily helper functions (4 tests)
  - PhaseMetrics dataclass (4 tests)
  - TaskMetrics dataclass (6 tests)
  - MetricsDB CRUD operations (7 tests)
  - WeeklyDigest creation and formatting (5 tests)
  - Weekly helper functions (4 tests)
  - TrendPoint dataclass (2 tests)
  - TrendAnalysis dataclass (2 tests)
  - Trend helper functions (8 tests)
  - TrendReport dataclass (2 tests)
  - NotificationChannel (4 tests)
  - NotificationConfig (3 tests)
  - Notification formatters (2 tests)
  - Notification functions (4 tests)
  - Integration tests (5 tests)

---

## Phase 10: Workflow Customization

**Priority:** LOW
**Spec:** `specs/phase-10/customization.md`
**Status:** 20% Complete (workflows exist)

### What Exists
- Simple, standard, sdlc workflows in `src/adw/workflows/`
- Prototype configs in `prototype.py` (no execution)
- Workflow phases in `src/adw/workflow/phases.py`

### Tasks

- [ ] **P10-1** Create `src/adw/workflows/dsl.py`
  - YAML-based workflow definitions
  - Each phase: name, prompt file, model, test commands
  - Store in `~/.adw/workflows/`
  - Load-time validation

- [ ] **P10-2** Add custom phase support
  - Add, remove, reorder phases
  - Conditional phases: `if: tests_failed`
  - Parallel execution, loop with `while: not_done`

- [ ] **P10-3** Implement prompt templating
  - Template variables: `{{task_description}}`
  - Include mechanism: `{{include common/safety.md}}`

- [ ] **P10-4** Add `adw prompt create <name>` CLI

- [ ] **P10-5** Build workflow library
  - Ship with: `sdlc`, `simple`, `prototype`, `bug-fix`
  - CLI: `adw workflow list`, `adw workflow use <name>`

- [ ] **P10-6** Add task configuration
  - Per-task workflow overrides (YAML)
  - Inline tags: `{opus, skip_review}`
  - Priority levels: `p0`, `p1`, `p2`

- [ ] **P10-7** Implement prototype workflow execution
  - Currently `prototype.py` is config only
  - Add `run_prototype_workflow()` function

---

## Phase 11: Simplification & Polish

**Priority:** LOW
**Spec:** `specs/phase-11/simplification.md`
**Status:** Not Started

### Tasks

- [ ] **P11-1** Consolidate workflows
  - Merge simple/prototype/standard into single adaptive SDLC
  - Adjust behavior based on task complexity
  - Eliminate multi-workflow distinction

- [ ] **P11-2** Simplify plugin system
  - Inline QMD integration (remove plugin abstraction if unused)
  - Document extension mechanism

- [ ] **P11-3** TUI dashboard cleanup
  - Remove unused widgets
  - Focus on: task list, logs, status
  - Make ASCII logo optional

- [ ] **P11-4** Config consolidation
  - Single config file: `~/.adw/config.toml`
  - Clear defaults for all options
  - Add `adw config show` CLI

- [ ] **P11-5** Improve error messages
  - Human-friendly with suggested fixes
  - Include documentation links
  - Hide stack traces by default

- [ ] **P11-6** Improve help & discoverability
  - Better `--help` with examples
  - Add `adw examples` command

- [ ] **P11-7** Write documentation
  - Getting started guide (< 5 minutes)
  - Complete reference
  - Common recipes
  - Troubleshooting guide

---

## Completed Tasks

### Agent Subsystem (Foundation)
- [x] Agent executor with retry logic (`src/adw/agent/executor.py`)
- [x] Agent process manager (`src/adw/agent/manager.py`)
- [x] Persistent state management (`src/adw/agent/state.py`)
- [x] Git worktree isolation (`src/adw/agent/worktree.py`)
- [x] Port allocation for parallel execution (`src/adw/agent/ports.py`)
- [x] Environment variable isolation (`src/adw/agent/environment.py`)
- [x] Task parser for tasks.md (`src/adw/agent/task_parser.py`)
- [x] Atomic task status updates (`src/adw/agent/task_updater.py`)
- [x] Model selector with heuristics (`src/adw/agent/model_selector.py`)

### Workflow Subsystem
- [x] Simple workflow: Build → Update (`src/adw/workflows/simple.py`)
- [x] Standard workflow: Plan → Implement → Update (`src/adw/workflows/standard.py`)
- [x] SDLC workflow: 6-phase with per-phase config (`src/adw/workflows/sdlc.py`)
- [x] Phase state machine with 12 phases (`src/adw/workflow/phases.py`)
- [x] Workflow persistence manager (`src/adw/workflow/manager.py`)

### TUI Dashboard
- [x] Main app with 3 panels (`src/adw/tui/app.py`)
- [x] Real-time log streaming (`src/adw/tui/log_watcher.py`)
- [x] Log formatting and buffering
- [x] Task list and detail widgets
- [x] Question/discussion modals
- [x] 20+ slash command handlers

### Integrations
- [x] GitHub issues integration (`src/adw/integrations/github.py`)
- [x] QMD semantic search integration (`src/adw/integrations/qmd.py`)
- [x] Cron daemon for autonomous execution (`src/adw/triggers/cron.py`)
- [x] GitHub webhook handler (basic) (`src/adw/triggers/webhook.py`)

### Plugin System
- [x] Base plugin class (`src/adw/plugins/base.py`)
- [x] Plugin manager with discovery (`src/adw/plugins/manager.py`)
- [x] QMD plugin with CLI commands (`src/adw/plugins/builtins/qmd/`)

### Other
- [x] Project type detection (`src/adw/detect.py`)
- [x] Spec parsing and loading (`src/adw/specs/`)
- [x] Message protocol (`src/adw/protocol/messages.py`)
- [x] Desktop notifications - macOS (`src/adw/notifications.py`)
- [x] Webhook callbacks - Slack/Discord (`src/adw/webhooks.py`)

---

## Notes & Learnings

### Architecture Observations
1. **Dual workflow systems exist**: `src/adw/workflows/` (execution) and `src/adw/workflow/` (state) are not connected
2. **Hook scripts duplicated**: Logic in `src/adw/hooks/handlers.py` duplicated in `.claude/hooks/*.py` scripts
3. **Prototype workflow incomplete**: `prototype.py` has configs but no execution function

### Code Quality Findings
- Agent subsystem is production-ready with zero TODOs
- TUI has many unused widgets (phase_indicator, spec_list) that could be integrated
- Exception handling in TUI sometimes too broad
- Regex-based file manipulation in state.py could be fragile

### Test Coverage Gaps
- No tests for: workflows, CLI commands, GitHub integration, plugins, hooks, dashboard
- Strong coverage for: agent models, task parsing, log streaming, dependency checking

### Performance Notes
- Hook execution must be <100ms per spec
- JSONL log rotation needed at 10MB
- Bundle compression recommended after 7 days

---

## Implementation Priority Order

1. **Phase 0** - Validation (CRITICAL - proves system works)
2. **Phase 1.1-1.5** - Safety guardrails (CRITICAL - prevents damage)
3. **Phase 2.1-2.5** - Test validation (HIGH - ensures code quality)
4. **Phase 2.6-2.10** - Smart retry (HIGH - resilience)
5. **Phase 8** - Failure recovery (MEDIUM - prevents work loss)
6. **Phase 1.6-1.14** - Screenshots & dashboard (MEDIUM - observability)
7. **Phase 3** - Context engineering (MEDIUM - efficiency)
8. **Phase 4** - Feedback loops (MEDIUM - human integration)
9. **Phase 5** - Specialized agents (MEDIUM - intelligence)
10. **Phase 9** - Reporting (LOW - analytics)
11. **Phase 7** - Entry points (LOW - more integrations)
12. **Phase 6** - Multi-repo (LOW - advanced use case)
13. **Phase 10** - Customization (LOW - flexibility)
14. **Phase 11** - Simplification (FINAL - polish)
