# ADW Implementation Plan

*Auto-generated by Ralph loop. Updated after each iteration.*

**Last Updated:** 2026-02-03
**Current Phase:** 5 (Specialized Agents - IN PROGRESS)
**Status:** Phase 5 self-improving system complete - pattern learning, expertise injection, /improve command, and adw learn CLI. Total: 706 tests passing.

---

## Executive Summary

Based on comprehensive codebase analysis comparing `src/adw/*` against `specs/phase-*/*.md`:

| Phase | Status | Completion |
|-------|--------|------------|
| 0 - Validation | Not Started | 0% |
| 1 - Observability & Safety | **COMPLETE** | **100%** |
| 2 - Quality Gates | **COMPLETE** | **100%** |
| 3 - Context Engineering | **COMPLETE** | **100%** |
| 4 - Feedback Loops | **COMPLETE** | **100%** |
| 5 - Specialized Agents | Partial | 65% |
| 6 - Multi-Repo | Not Started | 0% |
| 7 - Entry Points | Partial | 30% |
| 8 - Failure Recovery | **COMPLETE** | **100%** |
| 9 - Reporting | Not Started | 0% |
| 10 - Customization | Partial | 20% |
| 11 - Simplification | Not Started | 0% |

**Existing Strengths:**
- Agent subsystem is production-ready (executor, manager, state, worktree, ports)
- Workflow engines work (simple, standard, sdlc)
- TUI dashboard functional with real-time log streaming
- Plugin system complete with QMD integration
- Task parsing and status updates work
- Test framework detection (pytest, jest, vitest, go, cargo, etc.)
- Test execution with result parsing
- Smart retry with progressive strategies and escalation
- SDLC workflow integration with automatic test validation
- Implement-test retry loops with context injection
- Escalation report generation on test failure exhaustion
- Error classification with 50+ patterns (retriable, fixable, fatal, unknown)
- Recovery strategies (retry, fix, simplify, escalate)
- Checkpoint system for task state persistence
- WIP commit support for partial progress
- CLI commands: rollback, resume-task, checkpoints, escalation
- **NEW:** Context priming system with project-type detection
- **NEW:** Context bundles for session restoration
- **NEW:** CLI commands: prime generate/show/refresh, bundle list/show/diff/suggest/load/save/delete/compress
- **NEW:** PR review watcher with comment polling
- **NEW:** Comment parser for actionable feedback extraction
- **NEW:** Auto-fix system for review comments
- **NEW:** Human-in-the-loop approval gates with timeout
- **NEW:** CLI commands: watch-pr, fix-comments, approve-task, reject-task, continue-task, pending-approvals
- **NEW:** Expert framework with base class, knowledge persistence, and self-improvement
- **NEW:** FrontendExpert (React, Vue, CSS, accessibility)
- **NEW:** BackendExpert (FastAPI, Supabase, REST APIs)
- **NEW:** AIExpert (LLM integration, prompts, agents)
- **NEW:** Expert auto-selection from task keywords and file patterns
- GitHub integration (basic) works

---

## Phase 0: Foundation Validation

**Priority:** CRITICAL - Must complete first
**Spec:** `specs/phase-0/validation.md`
**Status:** Not Started

### Tasks

- [ ] **P0-1** Run end-to-end SDLC validation with `--version` flag task
  - Execute: plan → implement → test → review → document → commit
  - Use existing `adw run` or manual workflow trigger
  - Verify all phases complete without manual intervention

- [ ] **P0-2** Create `docs/VALIDATION_REPORT.md`
  - Document pass/fail for each SDLC phase
  - Record any error messages
  - Note manual interventions required
  - Target: < 10 minutes completion time

- [ ] **P0-3** Fix critical blockers (minimal changes only)
  - Create GitHub issues for each blocker
  - Apply unblocking fixes only
  - No refactoring or improvements

---

## Phase 1: Observability & Safety

**Priority:** HIGH
**Specs:** `specs/phase-1/hooks-integration.md`, `specs/phase-1/screenshot-capture.md`, `specs/phase-1/event-dashboard.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Basic hook handlers in `src/adw/hooks/handlers.py` (dispatch, logging)
- Complete hook scripts: `check_messages.py`, `context_bundle_builder.py`, `universal_logger.py`, `pre_tool_use.py`, `post_tool_use.py`, `stop.py`, `log_prompt.py`, `notification_handler.py`, `session_complete.py`
- `.claude/settings.json` properly configured with all hooks
- Basic dashboard in `src/adw/dashboard.py`
- Comprehensive test suite in `tests/test_hooks.py` (44 tests)

### Hooks Integration Tasks

- [x] **P1-1** Create `.claude/hooks/pre_tool_use.py` with comprehensive safety guardrails
  - Block: `rm -rf /`, `rm -rf ~`, fork bombs
  - Block: Commands touching `/etc`, `/usr`, `/var`
  - Block: `sudo` commands (unless explicit allow)
  - Block: `.env` files, `*_SECRET*` patterns, SSH keys
  - Log blocked attempts to `.adw/blocked.log`
  - Return exit 0 to allow, 1 to block

- [x] **P1-2** Create `.claude/hooks/post_tool_use.py` for tool usage logging
  - Log to `.adw/tool_usage.jsonl` (JSONL format)
  - Capture: timestamp, tool_name, parameters, result_summary
  - Auto-rotate logs when exceeding 10MB
  - Execute in <100ms

- [x] **P1-3** Create `.claude/hooks/stop.py` for session completion
  - Log to `.adw/sessions.jsonl`
  - Capture: session_id, duration, tools_used_count, files_modified
  - Generate session summary

- [x] **P1-4** Update `.claude/settings.json` to reference correct scripts
  - Fix references to missing scripts (log_prompt.py, session_complete.py, notification_handler.py)
  - Ensure all hooks are properly registered

- [x] **P1-5** Add comprehensive tests for hook guardrails

### Screenshot Capture Tasks

- [x] **P1-6** Create `src/adw/utils/screenshot.py`
  - `capture_screenshot(output_path: str) -> Path`
  - Use `screencapture -x` (silent, macOS)
  - Support custom region coordinates
  - Also includes `capture_browser_screenshot()` using Playwright
  - **Files:** `src/adw/utils/screenshot.py`, `src/adw/utils/__init__.py`

- [x] **P1-7** Add dev server detection
  - `is_dev_server_running(port: int) -> bool`
  - `detect_dev_server_ports() -> list[int]`
  - Monitor ports: 3000, 3001, 5173, 5174, 8000, 8080, 8888, 4200, 4000
  - Uses `lsof` on macOS, socket fallback for other systems
  - `is_dev_server_command()` detects 20+ dev server patterns
  - **Files:** `src/adw/utils/screenshot.py`

- [x] **P1-8** Integrate screenshot capture into hooks
  - Updated `.claude/hooks/post_tool_use.py` to detect dev server start commands
  - Patterns: npm/bun/pnpm/yarn dev, vite, next/nuxt dev, uvicorn, flask, gunicorn, fastapi, php -S, ng serve
  - Async capture with 3-second delay for server initialization
  - Stores to `agents/<task_id>/screenshots/screenshot-{timestamp}.png`
  - Logs captures to `.adw/screenshots.jsonl`
  - **Files:** `.claude/hooks/post_tool_use.py`

- [x] **P1-9** Add PR attachment functionality
  - `attach_screenshots_to_pr(pr_number: int, screenshots: list[Path])`
  - Uses `gh pr comment` CLI for reliable attachment
  - Auto-detects owner/repo from git remote
  - **Files:** `src/adw/utils/screenshot.py`

- [x] **P1-10** Add `adw screenshot` CLI command
  - Options: `--port`, `--delay`, `--output`, `--browser`, `--list`, `--task`
  - `adw screenshot --list` to view recent screenshots
  - `adw screenshot --browser` for Playwright-based capture
  - Includes `list_screenshots()` and `cleanup_old_screenshots()` utilities
  - **Files:** `src/adw/cli.py`

### Tests Added
- `tests/test_screenshot.py` - 61 tests covering all screenshot functionality

### Event Dashboard Tasks

- [x] **P1-11** Create `src/adw/observability/db.py` with SQLite database
  - Tables: `events` (id, timestamp, type, session_id, data JSON)
  - Tables: `sessions` (id, start_time, end_time, task_id, status)
  - Functions: `log_event()`, `get_events()`, `get_session()`, `start_session()`, `end_session()`
  - Store at `.adw/events.db`
  - **Files:** `src/adw/observability/db.py`, `src/adw/observability/models.py`, `src/adw/observability/__init__.py`

- [x] **P1-12** Add event stream panel to TUI
  - Display last 50 events in real-time
  - Color-coding: cyan (tool), red (error), green (success)
  - Toggle with `E` key
  - Polls database for new events every second
  - **Files:** `src/adw/tui/widgets/event_stream.py`, `src/adw/tui/app.py`, `src/adw/tui/styles.py`

- [x] **P1-13** Add `adw events` CLI with filtering
  - Filter by: event_type, session_id, task_id, time_range
  - Examples: `adw events --type tool --since 1h`, `adw events --follow`, `adw events --summary`
  - Also added `adw sessions` command to view sessions
  - **Files:** `src/adw/cli.py`

- [ ] **P1-14** (STRETCH) Create web dashboard `adw dashboard --web`
  - FastAPI server on port 3939
  - Routes: GET /, /api/events, /api/sessions, WS /ws
  - Simple Vue.js or vanilla JS frontend

### Tests Added
- `tests/test_observability.py` - 55 tests covering event database, models, and queries

---

## Phase 2: Quality Gates

**Priority:** HIGH
**Specs:** `specs/phase-2/test-validation.md`, `specs/phase-2/smart-retry.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Basic retry loop in `src/adw/agent/executor.py` (`prompt_with_retry()`)
- `RetryCode` enum in `src/adw/agent/models.py`
- Complete testing module (`src/adw/testing/`)
- Complete retry module (`src/adw/retry/`)
- **Integrated SDLC workflow** with test validation (`src/adw/workflows/sdlc.py`)

### Test Validation Tasks

- [x] **P2-1** Create `src/adw/testing/detector.py`
  - Detect: pytest, jest, vitest, npm test, bun test, go test, cargo test
  - Check config files: pytest.ini, package.json, vitest.config.ts, etc.
  - Return framework name and test command
  - **Files:** `src/adw/testing/detector.py`

- [x] **P2-2** Create `src/adw/testing/runner.py`
  - `run_tests(command: str) -> TestResult`
  - Run via subprocess with 5-minute timeout
  - Capture stdout/stderr, parse exit codes
  - Framework-specific output parsing
  - **Files:** `src/adw/testing/runner.py`

- [x] **P2-3** Create `TestResult` dataclass
  - Fields: passed, failed, skipped, errors counts
  - Failed test names and error messages with `FailedTest` dataclass
  - Coverage percentage (optional)
  - Support pytest, jest, vitest, go test, cargo test output formats
  - `to_retry_context()` method for retry integration
  - **Files:** `src/adw/testing/models.py`

- [x] **P2-4** Integrate test execution into SDLC workflow
  - Created `ValidationConfig` with max_retries, timeout, skip_tests options
  - `validate_tests()` for single-shot validation
  - `validate_with_retry()` for callback-based retry handling
  - Generates retry context for failed tests
  - **Files:** `src/adw/testing/validation.py`

- [x] **P2-5** Add test results to task completion
  - `TestResult.summary()` returns "Tests: X passed, Y failed, Z skipped (duration)"
  - `TestResult.format_failures()` lists failed test names
  - `get_test_report()` for formatted reports
  - **Files:** `src/adw/testing/models.py`, `src/adw/testing/validation.py`

### Smart Retry Tasks

- [x] **P2-6** Create `src/adw/retry/context.py`
  - `build_retry_context(error, phase, attempt_number, max_attempts, strategy)` -> str
  - Format errors with phase, message, instruction
  - `_truncate_stack_trace()` to prevent token overflow
  - `RetryContext` dataclass for structured context
  - **Files:** `src/adw/retry/context.py`

- [x] **P2-7** Add retry configuration
  - `ValidationConfig` with `max_retries` (default 3), `retry_delay_seconds` (default 2)
  - Exponential backoff support via `exponential_backoff` flag
  - **Files:** `src/adw/testing/validation.py`

- [x] **P2-8** Implement progressive retry strategies
  - `RetryStrategy` enum: SAME_APPROACH, ALTERNATIVE, SIMPLIFY
  - `select_retry_strategy()` selects strategy based on attempt number
  - Strategy-specific instructions in `_strategy_instructions()`
  - **Files:** `src/adw/retry/context.py`

- [x] **P2-9** Implement escalation protocol
  - `EscalationReport` dataclass with full report structure
  - `generate_escalation_report()` with pattern-based suggestions
  - `save_escalation_report()` writes to `agents/<task_id>/escalation.md`
  - `AttemptRecord` to track individual attempts
  - **Files:** `src/adw/retry/escalation.py`

- [x] **P2-10** Add retry logging
  - `AttemptRecord` captures: attempt_number, phase, error_message, strategy, duration, timestamp
  - Records passed to `ValidationResult` for history tracking
  - **Files:** `src/adw/retry/escalation.py`, `src/adw/testing/validation.py`

### Workflow Integration (NEW)

- [x] **P2-11** Integrate testing module into SDLC workflow TEST phase
  - `run_test_validation()` function calls testing module after TEST phase
  - Automatic test framework detection and execution
  - Test results stored in `PhaseResult.test_result`
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-12** Add retry context injection to implement phase
  - `execute_phase_with_retry()` supports injecting error context into prompts
  - After test failures, IMPLEMENT phase re-runs with formatted context
  - Progressive retry strategies (SAME_APPROACH → ALTERNATIVE → SIMPLIFY)
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-13** Wire up escalation report generation
  - When all test retries exhausted, generates `agents/{adw_id}/escalation.md`
  - Includes all attempt records with strategies and durations
  - Pattern-based suggestions for common errors
  - **Files:** `src/adw/workflows/sdlc.py`

- [x] **P2-14** Add CLI options for test validation
  - `--no-test-validation` flag to disable automatic test validation
  - `--test-retries N` to configure max implement-test cycles (default: 3)
  - **Files:** `src/adw/workflows/sdlc.py`

### Tests Added
- `tests/test_testing.py` - 42 tests for testing module
- `tests/test_retry.py` - 21 tests for retry module
- All 298 tests pass after workflow integration

---

## Phase 3: Context Engineering

**Priority:** MEDIUM
**Specs:** `specs/phase-3/context-priming.md`, `specs/phase-3/context-bundles.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete priming commands: `/prime`, `/prime_feature`, `/prime_bug`, `/prime_test`, `/prime_docs`
- Complete context module in `src/adw/context/` with priming and bundles
- CLI commands: `adw prime generate/show/refresh`, `adw bundle list/show/diff/suggest/load/save/delete/compress`
- 48 tests for context module

### Context Priming Tasks

- [x] **P3-1** Create `.claude/commands/prime_bug.md`
  - Error handling patterns, logging, debug techniques
  - Failure modes and recovery patterns
  - **Files:** `.claude/commands/prime_bug.md`

- [x] **P3-2** Create `.claude/commands/prime_test.md`
  - Test locations, mocking patterns, coverage requirements
  - Test framework conventions
  - **Files:** `.claude/commands/prime_test.md`

- [x] **P3-3** Create `.claude/commands/prime_docs.md`
  - Doc locations, style guide, example documentation
  - **Files:** `.claude/commands/prime_docs.md`

- [x] **P3-4** Expand `/prime_feature` (was minimal ~31 lines)
  - Now comprehensive with component patterns, testing conventions, PR checklist
  - Expanded from 31 to 254 lines
  - **Files:** `.claude/commands/prime_feature.md`

- [x] **P3-5** Create `adw prime` CLI command
  - `adw prime generate` - Auto-generate priming commands based on detected project type
  - Support: Python, Node.js, Go, Rust, TypeScript, React, Vue, Next.js, FastAPI, Django, Flask
  - Creates `.claude/commands/*_auto.md` dynamically
  - **Files:** `src/adw/context/priming.py`, `src/adw/cli.py`

- [x] **P3-6** Add `adw prime --refresh` for regeneration
  - `adw prime refresh` regenerates all auto-generated priming commands
  - `adw prime show` displays detected project info
  - Note: Deep Claude analysis (--deep) not yet implemented
  - **Files:** `src/adw/cli.py`

### Context Bundles Tasks

- [x] **P3-7** Create `src/adw/context/bundles.py`
  - `save_bundle(task_id: str, files: list)` - Persist bundles
  - `load_bundle(task_id: str) -> Bundle` - Retrieve bundles
  - `list_bundles()`, `delete_bundle()`, `get_bundle_file_contents()`
  - Store in `.adw/bundles/` directory
  - Excludes binary files, supports JSON and compressed formats
  - **Files:** `src/adw/context/bundles.py`, `src/adw/context/__init__.py`

- [x] **P3-8** Add `/load_bundle <task_id>` Claude command
  - Updated existing `/load_bundle` command to work with new bundle system
  - Display files, support for bundle operations
  - **Files:** `.claude/commands/load_bundle.md`

- [x] **P3-9** Add `adw bundle` CLI commands
  - `adw bundle load <task_id>` - Load bundle and show files
  - `adw bundle diff <task1> <task2>` - Show files added/removed/changed
  - `adw bundle list` - List all bundles
  - `adw bundle show <task_id>` - Show bundle details
  - `adw bundle save <task_id> <files...>` - Manually save bundle
  - `adw bundle delete <task_id>` - Delete bundle
  - **Files:** `src/adw/cli.py`

- [x] **P3-10** Implement smart bundle selection
  - `adw bundle suggest "description"` - Find similar past task bundles
  - Ranks by keyword matching in description, tags, and file paths
  - Returns top N bundles with relevance scores
  - **Files:** `src/adw/context/bundles.py`

- [x] **P3-11** Add bundle compression for old bundles (>7 days)
  - `adw bundle compress --days N` compresses bundles older than N days
  - Uses gzip compression for storage efficiency
  - **Files:** `src/adw/context/bundles.py`, `src/adw/cli.py`

### Tests Added
- `tests/test_context.py` - 48 tests covering:
  - Project type detection (14 tests)
  - Prime command generation (7 tests)
  - Bundle data structures (6 tests)
  - Bundle save/load (7 tests)
  - Bundle list/diff/suggest (6 tests)
  - Bundle file contents and compression (6 tests)
  - Bundle deletion (3 tests)

---

## Phase 4: Feedback Loops

**Priority:** MEDIUM
**Specs:** `specs/phase-4/pr-review-integration.md`, `specs/phase-4/human-in-loop.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete github module (`src/adw/github/`)
- PR review watcher with state persistence
- Comment parser with 20+ actionable patterns
- Auto-fix system with batch commits
- Approval gate system with TTL and expiration
- CLI commands for all operations

### PR Review Integration Tasks

- [x] **P4-1** Create `src/adw/github/review_watcher.py`
  - `PRReviewWatcher` class with state file persistence
  - `get_pr_review_comments()` polls inline and issue comments
  - `get_pr_status()` fetches PR info including approval status
  - Tracks seen comment IDs to prevent duplicates
  - **Files:** `src/adw/github/review_watcher.py`

- [x] **P4-2** Implement comment parser
  - `parse_review_comment()` with 20+ actionable patterns
  - Detects: change requests, add requests, fix requests, suggestions
  - Extracts `suggestion` code blocks as suggested changes
  - Filters: approvals (LGTM, emojis), questions, ADW-generated comments
  - Priority levels: HIGH, MEDIUM, LOW based on pattern
  - **Files:** `src/adw/github/comment_parser.py`

- [x] **P4-3** Implement auto-fix from comments
  - `AutoFixer` class with Claude Code integration
  - Builds context-rich prompts with file/line info
  - Single commit or batch commit modes
  - Dry run support
  - **Files:** `src/adw/github/auto_fix.py`

- [x] **P4-4** Add reviewer notification
  - `reply_to_comment()` replies to specific comment threads
  - `notify_reviewer()` posts fix confirmation with commit hash
  - ADW marker in comments prevents loops
  - **Files:** `src/adw/github/review_watcher.py`, `src/adw/github/auto_fix.py`

- [x] **P4-5** Add approval detection
  - `PRReviewWatcher.is_approved()` checks reviewDecision
  - `PRReviewWatcher.is_changes_requested()` detects requested changes
  - PR status tracking: OPEN, CLOSED, MERGED, DRAFT
  - **Files:** `src/adw/github/review_watcher.py`

### Human-in-the-Loop Tasks

- [x] **P4-6** Add `awaiting_review` task status
  - Added `AWAITING_REVIEW` to `TaskStatus` enum
  - **Files:** `src/adw/agent/models.py`

- [x] **P4-7** Create plan approval gate
  - `ApprovalRequest` dataclass with full state
  - `ApprovalGate` class for workflow integration
  - Generates `agents/<task_id>/APPROVAL_REQUEST.md`
  - 24-hour TTL with automatic expiration check
  - **Files:** `src/adw/github/approval_gate.py`

- [x] **P4-8** Add CLI commands: `adw approve-task`, `adw reject-task`
  - `adw approve-task <task_id>` approves pending requests
  - `adw reject-task <task_id> --reason "..."` rejects with feedback
  - `adw pending-approvals` lists all pending requests
  - **Files:** `src/adw/cli.py`

- [x] **P4-9** Add continue prompts: `adw continue-task <task_id> "feedback"`
  - Stores feedback history with timestamps
  - `get_approval_context()` injects feedback into prompts
  - Tracks phase context for each prompt
  - **Files:** `src/adw/github/approval_gate.py`, `src/adw/cli.py`

- [x] **P4-10** Add configuration options
  - `ApprovalGate.enabled` flag for enabling/disabling
  - `ApprovalGate.auto_approve_low_risk` for auto-approving low risk tasks
  - Environment variable: `ADW_AUTO_APPROVE=1` disables gates
  - **Files:** `src/adw/github/approval_gate.py`

### CLI Commands Added
- `adw github watch-pr <pr>` - Watch PR for review comments
- `adw github fix-comments <pr>` - Fix actionable review comments
- `adw approve-task <task_id>` - Approve pending task
- `adw reject-task <task_id> -r <reason>` - Reject with reason
- `adw continue-task <task_id> <feedback>` - Add iterative feedback
- `adw pending-approvals` - List pending approval requests

### Tests Added
- `tests/test_github.py` - 44 tests covering:
  - ReviewComment serialization (3 tests)
  - PRInfo serialization (1 test)
  - PRReviewWatcher state management (4 tests)
  - Comment parser patterns (11 tests)
  - FixResult status (2 tests)
  - AutoFixer prompt building (3 tests)
  - ApprovalRequest lifecycle (5 tests)
  - Approval functions (8 tests)
  - ApprovalGate configuration (5 tests)
  - ContinuePrompt serialization (2 tests)

---

## Phase 5: Specialized Agents

**Priority:** MEDIUM
**Specs:** `specs/phase-5/agent-experts.md`, `specs/phase-5/self-improving.md`, `specs/phase-5/specialized-planners.md`
**Status:** 65% Complete (expert framework, 3 experts, auto-selection, self-improving system)

### What Exists
- `/experts:cc_expert` and `/experts:cc_expert:improve` commands
- `/plan_vite_vue` specialized planner (696 lines, comprehensive)
- Complete expert module in `src/adw/experts/`
- Expert auto-selection system with keyword and file pattern matching
- **NEW:** Complete learning module in `src/adw/learning/`
- **NEW:** Pattern store with persistence at `~/.adw/learning/`
- **NEW:** Expertise section injection into SDLC workflow prompts
- **NEW:** `/improve` command for extracting learnings
- **NEW:** `adw learn` CLI commands (show, stats, export, import, add, clear, report)
- 87 tests for expert + learning modules

### Expert Framework Tasks

- [x] **P5-1** Create `src/adw/experts/base.py`
  - Base `Expert` class with: `domain`, `knowledge`, `plan()`, `build()`, `improve()`
  - `ExpertKnowledge` dataclass with patterns, best_practices, known_issues, learnings
  - Knowledge persistence at `~/.adw/experts/<name>/knowledge.json`
  - `register_expert`, `get_expert`, `list_experts` registry functions
  - **Files:** `src/adw/experts/base.py`, `src/adw/experts/__init__.py`

- [x] **P5-2** Create `src/adw/experts/frontend.py`
  - Focus: React, Vue, CSS, accessibility
  - Default best practices and patterns for frontend development
  - Framework-specific guidance (React vs Vue)
  - Accessibility checklist in plans
  - **Files:** `src/adw/experts/frontend.py`

- [x] **P5-3** Create `src/adw/experts/backend.py`
  - Focus: FastAPI, Supabase, REST APIs, Django, Flask
  - Default best practices for API design and database operations
  - Framework-specific guidance (FastAPI vs Django vs Flask)
  - **Files:** `src/adw/experts/backend.py`

- [x] **P5-4** Create `src/adw/experts/ai.py`
  - Focus: LLM integration, prompts, agents, RAG
  - Use-case specific guidance (agent, RAG, chatbot, general)
  - Default best practices for prompt engineering and error handling
  - **Files:** `src/adw/experts/ai.py`

- [x] **P5-5** Implement expert auto-selection
  - `select_experts()` with keyword and file pattern matching
  - 20+ keyword patterns per domain with confidence scores
  - 10+ file patterns per domain
  - Multi-expert collaboration support
  - `ExpertMatch` dataclass with score and reasons
  - `detect_domain_from_path()` helper function
  - **Files:** `src/adw/experts/selector.py`

### Self-Improving Tasks

- [x] **P5-6** Add `## Expertise` section to agent prompts
  - `inject_expertise_into_prompt()` adds expertise to PLAN and IMPLEMENT phases
  - Combines expert knowledge with project-specific learnings
  - Auto-injects patterns, issues, best practices, mistakes to avoid
  - **Files:** `src/adw/learning/expertise.py`, `src/adw/workflows/sdlc.py`

- [x] **P5-7** Create `/improve` command
  - Analyzes recent task execution for learnings
  - Prompts for patterns, issues, and insights
  - Records to `~/.adw/learning/<project>/patterns.json`
  - **Files:** `.claude/commands/improve.md`

- [x] **P5-8** Implement pattern learning
  - `Learning` dataclass with type, content, domain, success_count
  - `PatternStore` for persistence and retrieval
  - `extract_learnings_from_feedback()` with 20+ regex patterns
  - `record_task_outcome()` for automatic learning from tasks
  - Supports: patterns, issues, best_practices, mistakes
  - **Files:** `src/adw/learning/patterns.py`

- [x] **P5-9** Add `adw learn` CLI
  - `adw learn show` - View learnings with filtering
  - `adw learn stats` - Statistics on accumulated learnings
  - `adw learn export` / `adw learn import` - Share learnings
  - `adw learn add` - Manually add learnings
  - `adw learn clear` - Clear learnings
  - `adw learn report` - Generate full expertise report
  - **Files:** `src/adw/cli.py`

### Specialized Planners Tasks

- [ ] **P5-10** Create `.claude/commands/plan_fastapi.md`
  - Router patterns, Pydantic models, dependency injection
  - API-first planning

- [ ] **P5-11** Create `.claude/commands/plan_react.md`
  - Component hierarchy, state management, hooks
  - Component-first planning

- [ ] **P5-12** Create `.claude/commands/plan_nextjs.md`
  - App Router vs Pages Router, Server Components
  - SSR/SSG considerations

- [ ] **P5-13** Create `.claude/commands/plan_supabase.md`
  - PostgreSQL schema, Row Level Security, Edge Functions
  - Database-first planning

- [ ] **P5-14** Implement auto-detect planner in `adw plan`
  - Detect from: requirements.txt → Python, package.json → Node
  - Fallback to generic planner

### Tests Added
- `tests/test_experts.py` - 49 tests covering:
  - ExpertKnowledge dataclass (10 tests)
  - FrontendExpert functionality (6 tests)
  - BackendExpert functionality (5 tests)
  - AIExpert functionality (5 tests)
  - Expert registry (5 tests)
  - Expert auto-selection (8 tests)
  - Domain detection from paths (5 tests)
  - Expert stats (1 test)
  - Integration tests (2 tests)
  - File-based expert selection (2 tests)

- `tests/test_learning.py` - 38 tests covering:
  - Learning dataclass (5 tests)
  - LearningType enum (1 test)
  - PatternStore CRUD (8 tests)
  - TaskOutcome serialization (1 test)
  - Learning extraction from feedback (6 tests)
  - Domain detection from files (4 tests)
  - Expertise section building (4 tests)
  - Expertise injection (2 tests)
  - Combined expertise (2 tests)
  - Record outcome (3 tests)
  - Integration tests (2 tests)

---

## Phase 6: Multi-Repo Orchestration

**Priority:** LOW
**Spec:** `specs/phase-6/multi-repo.md`
**Status:** Not Started

### Tasks

- [ ] **P6-1** Create workspace configuration `~/.adw/workspace.toml`
  - Workspace name and repo registry
  - Repo entries: name, path, type (nextjs, fastapi)
  - Define repo relationships/dependencies

- [ ] **P6-2** Add CLI: `adw workspace init`, `adw workspace add <path>`

- [ ] **P6-3** Implement cross-repo task queue
  - Unified queue spanning all repos
  - Task syntax: `{repo: "frontend"}`
  - Auto-detect repo from file paths

- [ ] **P6-4** Add task dependency support
  - Syntax: `{depends_on: ["task-123"]}`
  - Cross-repo dependencies
  - Display blocking reasons

- [ ] **P6-5** Implement unified context
  - Agents read files from any workspace repo
  - Understand API contracts between repos
  - Workspace-level + per-repo CLAUDE.md

- [ ] **P6-6** Add coordinated PRs
  - Create linked PRs across repos
  - PR descriptions reference related PRs
  - `adw pr link <pr1> <pr2>`
  - Support atomic merging (all or nothing)

---

## Phase 7: Entry Points

**Priority:** LOW
**Spec:** `specs/phase-7/entry-points.md`
**Status:** 30% Complete (GitHub works)

### What Exists
- GitHub issues integration (`src/adw/integrations/github.py`)
- GitHub trigger polling (`src/adw/triggers/github.py`)
- Basic webhook handler (`src/adw/triggers/webhook.py`)
- Cron daemon fully functional

### GitHub Enhancement Tasks

- [ ] **P7-1** Add issue template parsing
- [ ] **P7-2** Implement label-based workflow selection (currently hardcoded "standard")

### Notion Integration Tasks

- [ ] **P7-3** Create `src/adw/integrations/notion.py`
  - Poll Notion database for tasks
  - Map properties: Title → description, Status → ADW status, Tags → workflow
  - Bidirectional sync (write status back)

- [ ] **P7-4** Add `adw notion watch` CLI

### Slack Integration Tasks

- [ ] **P7-5** Create `src/adw/integrations/slack.py`
  - OAuth-enabled Slack app
  - Slash commands: `/adw create`, `/adw status`, `/adw approve`
  - Thread-based progress updates
  - Button interactions for approve/reject

### Linear Integration Tasks

- [ ] **P7-6** Create `src/adw/integrations/linear.py`
  - Linear API authentication
  - Bidirectional sync: Linear issue ↔ ADW task

- [ ] **P7-7** Add `adw linear sync` CLI

### Webhook Enhancement Tasks

- [ ] **P7-8** Add generic `/api/tasks` endpoint (not just GitHub-specific)
  - Accept JSON: description, workflow type, repo
  - API key authentication
  - Return task ID

- [ ] **P7-9** Add callback URL for task completion notifications

### Telegram Bot (BONUS)

- [ ] **P7-10** Create `src/adw/integrations/telegram.py`
  - Commands: `/task`, `/status`, `/approve`

---

## Phase 8: Failure Recovery

**Priority:** MEDIUM
**Spec:** `specs/phase-8/failure-recovery.md`
**Status:** ✅ COMPLETE (100%)

### What Exists
- Complete recovery module (`src/adw/recovery/`)
- Error classification system with 50+ patterns
- Four recovery strategies with orchestration
- Checkpoint system with persistence
- WIP commit support for partial progress
- CLI commands: `adw rollback`, `adw resume-task`, `adw checkpoints`, `adw escalation`
- Comprehensive test suite (113 tests)

### Tasks

- [x] **P8-1** Create `src/adw/recovery/classifier.py`
  - Classify errors: `retriable` (network/timeout), `fixable` (test/lint), `fatal` (config/deps), `unknown`
  - 50+ regex patterns for error classification
  - Confidence scoring and suggested actions
  - Helper functions: `is_retriable()`, `is_fixable()`, `is_fatal()`
  - **Files:** `src/adw/recovery/classifier.py`

- [x] **P8-2** Implement recovery strategies
  - `RetryRecoveryStrategy` - Simple retry with exponential backoff
  - `FixRecoveryStrategy` - Auto-fix based on error classification
  - `SimplifyRecoveryStrategy` - Reduce task scope on final attempt
  - `EscalateRecoveryStrategy` - Escalate to human with notification callback
  - `RecoveryOrchestrator` - Higher-level orchestration across strategies
  - `select_recovery_strategy()` - Intelligent strategy selection
  - **Files:** `src/adw/recovery/strategies.py`

- [x] **P8-3** Add partial commit system
  - `create_wip_commit()` - Commit working changes with `[WIP]` prefix
  - Track staged vs unstaged changes
  - Include ADW ID in commit message
  - **Files:** `src/adw/recovery/checkpoints.py`

- [x] **P8-4** Create `src/adw/recovery/checkpoints.py`
  - `Checkpoint` dataclass with full state serialization
  - `CheckpointManager` class for session management
  - Functions: `save_checkpoint()`, `load_checkpoint()`, `list_checkpoints()`
  - `get_last_checkpoint()`, `get_last_successful_checkpoint()`
  - `clear_old_checkpoints()` for cleanup (configurable days)
  - Git commit tracking in checkpoints
  - **Files:** `src/adw/recovery/checkpoints.py`

- [x] **P8-5** Add rollback capability
  - `adw rollback <task_id>` - Undo all task changes
  - `rollback_to_checkpoint()` - Reset to specific checkpoint
  - `rollback_all_changes()` - Undo all task changes
  - Git reset integration
  - Task status update to "failed"
  - **Files:** `src/adw/recovery/checkpoints.py`, `src/adw/cli.py`

- [x] **P8-6** Generate escalation reports
  - Already implemented in Phase 2 (`src/adw/retry/escalation.py`)
  - `adw escalation <task_id>` CLI command to view reports
  - **Files:** `src/adw/cli.py`

### CLI Commands Added
- `adw rollback <task_id>` - Rollback to last checkpoint or specific checkpoint
- `adw resume-task <task_id>` - Resume from last successful checkpoint
- `adw checkpoints <task_id>` - List all checkpoints for a task
- `adw escalation <task_id>` - View escalation report

### Tests Added
- `tests/test_recovery.py` - 113 tests covering:
  - Error classification (50+ test cases)
  - Recovery strategies (all 4 strategies)
  - Checkpoint persistence (save/load/list/delete)
  - WIP commit functionality

---

## Phase 9: Reporting & Analytics

**Priority:** LOW
**Spec:** `specs/phase-9/reporting.md`
**Status:** Not Started

### Tasks

- [ ] **P9-1** Create `src/adw/reports/daily.py`
  - Generate at midnight (configurable)
  - Metrics: completed/failed/in-progress counts, commits, PRs, estimated time saved

- [ ] **P9-2** Add `adw report daily` CLI

- [ ] **P9-3** Create weekly digest with trend analysis
  - Week-over-week comparison
  - Highlight best/worst performing tasks

- [ ] **P9-4** Add `adw report weekly` CLI

- [ ] **P9-5** Create metrics database `~/.adw/metrics.db`
  - Per-task: duration per phase, retry count, token usage, commits

- [ ] **P9-6** Add `adw metrics <task_id>` CLI

- [ ] **P9-7** Implement cost tracking
  - Calculate API costs using Anthropic pricing
  - Input/output token pricing tiers
  - Daily/weekly/monthly totals

- [ ] **P9-8** Add `adw costs --period [week|month]` CLI

- [ ] **P9-9** Add trend analysis
  - Track: success rate, avg duration, cost per task, retry frequency
  - Anomaly detection for sudden failures

- [ ] **P9-10** Add TUI visualization with sparklines

- [ ] **P9-11** Add notification system
  - Configurable channels (Slack/Discord)
  - Events: task_start, task_complete, task_failed, daily_summary

---

## Phase 10: Workflow Customization

**Priority:** LOW
**Spec:** `specs/phase-10/customization.md`
**Status:** 20% Complete (workflows exist)

### What Exists
- Simple, standard, sdlc workflows in `src/adw/workflows/`
- Prototype configs in `prototype.py` (no execution)
- Workflow phases in `src/adw/workflow/phases.py`

### Tasks

- [ ] **P10-1** Create `src/adw/workflows/dsl.py`
  - YAML-based workflow definitions
  - Each phase: name, prompt file, model, test commands
  - Store in `~/.adw/workflows/`
  - Load-time validation

- [ ] **P10-2** Add custom phase support
  - Add, remove, reorder phases
  - Conditional phases: `if: tests_failed`
  - Parallel execution, loop with `while: not_done`

- [ ] **P10-3** Implement prompt templating
  - Template variables: `{{task_description}}`
  - Include mechanism: `{{include common/safety.md}}`

- [ ] **P10-4** Add `adw prompt create <name>` CLI

- [ ] **P10-5** Build workflow library
  - Ship with: `sdlc`, `simple`, `prototype`, `bug-fix`
  - CLI: `adw workflow list`, `adw workflow use <name>`

- [ ] **P10-6** Add task configuration
  - Per-task workflow overrides (YAML)
  - Inline tags: `{opus, skip_review}`
  - Priority levels: `p0`, `p1`, `p2`

- [ ] **P10-7** Implement prototype workflow execution
  - Currently `prototype.py` is config only
  - Add `run_prototype_workflow()` function

---

## Phase 11: Simplification & Polish

**Priority:** LOW
**Spec:** `specs/phase-11/simplification.md`
**Status:** Not Started

### Tasks

- [ ] **P11-1** Consolidate workflows
  - Merge simple/prototype/standard into single adaptive SDLC
  - Adjust behavior based on task complexity
  - Eliminate multi-workflow distinction

- [ ] **P11-2** Simplify plugin system
  - Inline QMD integration (remove plugin abstraction if unused)
  - Document extension mechanism

- [ ] **P11-3** TUI dashboard cleanup
  - Remove unused widgets
  - Focus on: task list, logs, status
  - Make ASCII logo optional

- [ ] **P11-4** Config consolidation
  - Single config file: `~/.adw/config.toml`
  - Clear defaults for all options
  - Add `adw config show` CLI

- [ ] **P11-5** Improve error messages
  - Human-friendly with suggested fixes
  - Include documentation links
  - Hide stack traces by default

- [ ] **P11-6** Improve help & discoverability
  - Better `--help` with examples
  - Add `adw examples` command

- [ ] **P11-7** Write documentation
  - Getting started guide (< 5 minutes)
  - Complete reference
  - Common recipes
  - Troubleshooting guide

---

## Completed Tasks

### Agent Subsystem (Foundation)
- [x] Agent executor with retry logic (`src/adw/agent/executor.py`)
- [x] Agent process manager (`src/adw/agent/manager.py`)
- [x] Persistent state management (`src/adw/agent/state.py`)
- [x] Git worktree isolation (`src/adw/agent/worktree.py`)
- [x] Port allocation for parallel execution (`src/adw/agent/ports.py`)
- [x] Environment variable isolation (`src/adw/agent/environment.py`)
- [x] Task parser for tasks.md (`src/adw/agent/task_parser.py`)
- [x] Atomic task status updates (`src/adw/agent/task_updater.py`)
- [x] Model selector with heuristics (`src/adw/agent/model_selector.py`)

### Workflow Subsystem
- [x] Simple workflow: Build → Update (`src/adw/workflows/simple.py`)
- [x] Standard workflow: Plan → Implement → Update (`src/adw/workflows/standard.py`)
- [x] SDLC workflow: 6-phase with per-phase config (`src/adw/workflows/sdlc.py`)
- [x] Phase state machine with 12 phases (`src/adw/workflow/phases.py`)
- [x] Workflow persistence manager (`src/adw/workflow/manager.py`)

### TUI Dashboard
- [x] Main app with 3 panels (`src/adw/tui/app.py`)
- [x] Real-time log streaming (`src/adw/tui/log_watcher.py`)
- [x] Log formatting and buffering
- [x] Task list and detail widgets
- [x] Question/discussion modals
- [x] 20+ slash command handlers

### Integrations
- [x] GitHub issues integration (`src/adw/integrations/github.py`)
- [x] QMD semantic search integration (`src/adw/integrations/qmd.py`)
- [x] Cron daemon for autonomous execution (`src/adw/triggers/cron.py`)
- [x] GitHub webhook handler (basic) (`src/adw/triggers/webhook.py`)

### Plugin System
- [x] Base plugin class (`src/adw/plugins/base.py`)
- [x] Plugin manager with discovery (`src/adw/plugins/manager.py`)
- [x] QMD plugin with CLI commands (`src/adw/plugins/builtins/qmd/`)

### Other
- [x] Project type detection (`src/adw/detect.py`)
- [x] Spec parsing and loading (`src/adw/specs/`)
- [x] Message protocol (`src/adw/protocol/messages.py`)
- [x] Desktop notifications - macOS (`src/adw/notifications.py`)
- [x] Webhook callbacks - Slack/Discord (`src/adw/webhooks.py`)

---

## Notes & Learnings

### Architecture Observations
1. **Dual workflow systems exist**: `src/adw/workflows/` (execution) and `src/adw/workflow/` (state) are not connected
2. **Hook scripts duplicated**: Logic in `src/adw/hooks/handlers.py` duplicated in `.claude/hooks/*.py` scripts
3. **Prototype workflow incomplete**: `prototype.py` has configs but no execution function

### Code Quality Findings
- Agent subsystem is production-ready with zero TODOs
- TUI has many unused widgets (phase_indicator, spec_list) that could be integrated
- Exception handling in TUI sometimes too broad
- Regex-based file manipulation in state.py could be fragile

### Test Coverage Gaps
- No tests for: workflows, CLI commands, GitHub integration, plugins, hooks, dashboard
- Strong coverage for: agent models, task parsing, log streaming, dependency checking

### Performance Notes
- Hook execution must be <100ms per spec
- JSONL log rotation needed at 10MB
- Bundle compression recommended after 7 days

---

## Implementation Priority Order

1. **Phase 0** - Validation (CRITICAL - proves system works)
2. **Phase 1.1-1.5** - Safety guardrails (CRITICAL - prevents damage)
3. **Phase 2.1-2.5** - Test validation (HIGH - ensures code quality)
4. **Phase 2.6-2.10** - Smart retry (HIGH - resilience)
5. **Phase 8** - Failure recovery (MEDIUM - prevents work loss)
6. **Phase 1.6-1.14** - Screenshots & dashboard (MEDIUM - observability)
7. **Phase 3** - Context engineering (MEDIUM - efficiency)
8. **Phase 4** - Feedback loops (MEDIUM - human integration)
9. **Phase 5** - Specialized agents (MEDIUM - intelligence)
10. **Phase 9** - Reporting (LOW - analytics)
11. **Phase 7** - Entry points (LOW - more integrations)
12. **Phase 6** - Multi-repo (LOW - advanced use case)
13. **Phase 10** - Customization (LOW - flexibility)
14. **Phase 11** - Simplification (FINAL - polish)
